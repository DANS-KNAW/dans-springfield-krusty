define(["config/BaseConfig",],function(a){var b=function(g){var f={};var h={data:null,ticket:null,starttime:0,videos:null,audios:null,screenshot:null};$.extend(h,g);function d(){e();c()}function e(){var l=$(h.data);var o=!$(l).find("presentation > videoplaylist > properties > play-mode").text()?"continuous":$(l).find("presentation > videoplaylist > properties > play-mode").text();var n=l.find("presentation > videoplaylist").first().find("video");var m=l.find("presentation > videoplaylist").first().find("audio");var k={};k.duration=0;k.length=n.length;var j={};j.duration=0;j.length=m.length;if(n.length>0){$.each(n,function(r,p){var x=$(l.find('fsxml > video[fullid|="'+$(p).attr("referid")+'"]'));var y={};y.starttime=!$(p).find("starttime").text()?0:parseFloat($(p).find("starttime").text());y.duration=!$(p).find("duration").text()?-1:parseFloat($(p).find("duration").text());var s=!$(p).find("webvtt").text()?undefined:a.baseURI+"/data"+x.attr("fullid")+"/"+$(p).find("webvtt").text();y.title=!$(p).find("title").text()?undefined:$(p).find("title").text();if(h.ticket!=undefined&&s!=undefined){s=s+"?ticket="+g.ticket}var w=[];if(s==undefined){var t=$(p).find("*").filter(function(){return/^webvtt_/i.test(this.nodeName)});for(i=0;i<t.length;i++){sObj={};sObj.language=t[i].tagName.substr(t[i].tagName.indexOf("_")+1);var u=a.baseURI+"/data"+x.attr("fullid")+"/"+t[i].textContent;if(h.ticket!=undefined){u=u+"?ticket="+g.ticket}sObj.subtitle=u;w.push(sObj)}}else{sObj={};sObj.language=undefined;sObj.subtitle=s;w.push(sObj)}y.subtitles=w;y.position=r;y.sources=[];var q=0;if(x.children("rawvideo").length>0){$.each(x.children("rawvideo"),function(A,B){B=$(B);if((!B.find("original").text()&&B.find("wantedheight").text()!=="")||x.children("rawvideo").length===1){var E=false;var D=$.grep(y.sources,function(F){return F.quality==(B.find("wantedheight").text())});if(D===null){E=true;D={}}D.quality=B.find("height").text()+"p";if(D.codecs===undefined){D.codecs=[]}var C={};switch(B.find("extension").text()){case"mp4":C.type="video/mp4"}var v=B.find("mount").text().split(",")[0];C.src=a.baseURI+"/rafael/"+x.attr("fullid")+"/rawvideo/"+B.attr("id")+"/"+B.find("filename").text();var z=x.attr("fullid");D.codecs.push(C);y.sources.push(D);q=B.find("duration").text()!==""?parseFloat(B.find("duration").text())*1000:q;y.oduration=q;y.referid=$(p).attr("referid")}})}k[r]=y;k.duration=y.duration==-1?k.duration+q:k.duration+y.duration})}if(m.length>0){$.each(m,function(q,s){var r=$(l.find('fsxml > audio[fullid|="'+$(s).attr("referid")+'"]'));var p={};p.starttime=!$(s).find("starttime").text()?0:parseFloat($(s).find("starttime").text());p.duration=!$(s).find("duration").text()?-1:parseFloat($(s).find("duration").text());p.title=!$(s).find("title").text()?undefined:$(s).find("title").text();p.position=q;p.sources=[];var t=0;if(r.children("rawaudio").length>0){$.each(r.children("rawaudio"),function(w,x){x=$(x);if(!x.find("original").text()||r.children("rawaudio").length===1){add=true;var z={};if(z.codecs===undefined){z.codecs=[]}var y={};switch(x.find("extension").text()){case"m4a":y.type="audio/mp4"}var u=x.find("mount").text().split(",")[0];y.src=a.baseURI+"/rafael/"+r.attr("fullid")+"/rawaudio/"+x.attr("id")+"/"+x.find("filename").text();var v=r.attr("fullid");z.codecs.push(y);p.sources.push(z);t=x.find("duration").text()!==""?parseFloat(x.find("duration").text())*1000:t;p.oduration=t}})}j[q]=p;j.duration=p.duration==-1?j.duration+t:j.duration+p.duration})}h.playMode=o;h.videos=k;h.audios=j}function c(){var r=h.starttime*1000;var t=0;var n="";for(var m=0;m<h.videos.length;m++){r-=h.videos[m].duration==-1?h.videos[m].oduration:h.videos[m].duration;if(r<0){n=h.videos[m].referid;r+=h.videos[m].duration==-1?h.videos[m].oduration:h.videos[m].duration;t=h.videos[m].starttime!=0?h.videos[h.currentItem].starttime+r:r}}var l=$(h.data);var s=$(l.find('fsxml > video[fullid|="'+n+'"]'));var u=s.find("screens");var j=u.find("properties > uri").text();j=j.replace("http://","");j=j.replace(".noterik.com",a.baseURI+"/data");
var o=Math.floor(parseInt(t)/1000)+(t==0?10:0);var p=Math.floor(o/3600);var k=Math.floor((o%3600)/60);var q=Math.floor((o%3600)%60);h.screenshot=j+"/h/"+p+"/m/"+k+"/sec"+q+".jpg"}f.getVideos=function(){return h.videos};f.getAudios=function(){return h.audios};f.getPlayMode=function(){return h.playMode};f.getScreenshot=function(){return h.screenshot};d();return f};return b});