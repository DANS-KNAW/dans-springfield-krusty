define([],function(){var a=function(f){var e={};var g={data:null,videos:null,screenshot:null};$.extend(g,f);function c(){d();b()}function d(){var i=$(g.data);var j=i.find("presentation > videoplaylist").first().find("video");var h={};h.duration=0;h.length=j.length;$.each(j,function(m,o){var n=$(i.find('fsxml > video[fullid|="'+$(o).attr("referid")+'"]'));var l={};l.starttime=!$(o).find("starttime").text()?0:parseFloat($(o).find("starttime").text());l.duration=!$(o).find("duration").text()?-1:parseFloat($(o).find("duration").text());l.position=m;l.sources=[];var p=0;if(n.children("rawvideo").length>0){$.each(n.children("rawvideo"),function(r,s){s=$(s);if((!s.find("original").text()&&s.find("wantedheight").text()!=="")||n.children("rawvideo").length===1){var v=false;var u=$.grep(l.sources,function(w){return w.quality==(s.find("wantedheight").text())});if(u===null){v=true;u={}}u.quality=s.find("height").text()+"p";if(u.codecs===undefined){u.codecs=[]}var t={};switch(s.find("extension").text()){case"mp4":t.type="video/mp4"}var k=s.find("mount").text().split(",")[0];t.src="http://streaming11.dans.knaw.nl/rafael/"+n.attr("fullid")+"/rawvideo/"+s.attr("id")+"/"+s.find("filename").text();var q=n.attr("fullid");u.codecs.push(t);l.sources.push(u);p=s.find("duration").text()!==""?parseFloat(s.find("duration").text())*1000:p}})}h[m]=l;h.duration=l.duration==-1?h.duration+p:h.duration+l.duration});g.videos=h}function b(){var k=$(g.data);var h=k.find("presentation > videoplaylist").first().find("video").first();var o=!$(h).find("starttime").text()?0:$(h).find("starttime").text();var p=$(k.find('fsxml > video[fullid|="'+h.attr("referid")+'"]'));var q=p.find("screens");var i=q.find("properties > uri").text();i=i.replace(".noterik.com","streaming11.dans.knaw.nl/stills");var l=Math.floor(parseInt(o)/1000)+10;var m=Math.floor(l/3600);var j=Math.floor((l%3600)/60);var n=Math.floor((l%3600)%60);g.screenshot=i+"/h/"+m+"/m/"+j+"/sec"+n+".jpg"}e.getVideos=function(){return g.videos};e.getScreenshot=function(){return g.screenshot};c();return e};return a});