define(["libs/jquery.browser.mobile"],function(){var a=function(k){var j={};var f={videos:null,quality:"360p",currentOrder:null,currentItem:0,order:{mobile:["360p","180p","720p","1080p"],desktop:["720p","1080p","720p","1080p"]},ticket:null,wasPlaying:false,seekTime:-1};var d=0;var b=0;$.extend(f,k);j.create=function(){var m=$(document.createElement("video"));m.attr("id","videoplayer");var o=e(f);var n=g(o.codecs,"video/mp4");if(n.streamSrc!==undefined){var l=$(document.createElement("source"));l.attr("src",n.streamSrc);l.attr("type",n.type);m.append(l)}o=$(document.createElement("source"));o.attr("src",n.src+c());o.attr("type",n.type);m.append(o);m.on("ended",function(){f.currentItem=f.currentItem<f.videos.length-1?f.currentItem+1:0;i(m)});$("#seek-bar").attr("max",f.videos.duration);$("#playtime").text(formatTime(0));$("#totaltime").text(formatTime(f.videos.duration/1000));m.on("play",function(){$("#play-pause > span").addClass("fa-pause");$("#play-pause > span").removeClass("fa-play")});m.on("pause",function(){$("#play-pause > span").addClass("fa-play");$("#play-pause > span").removeClass("fa-pause")});m.on("timeupdate",function(){var p=(this.currentTime*1000)-f.videos[f.currentItem].starttime;if(p<0){p=0}$("#playtime").text(formatTime((b/1000)+p/1000));$("#seek-bar").val(b+p);if(f.videos[f.currentItem].duration!=-1&&p>=f.videos[f.currentItem].duration){f.currentItem=f.currentItem<f.videos.length-1?f.currentItem+1:0;i(m)}});m[0].addEventListener("volumechange",function(){if(m[0].muted==true||m[0].volume==0){$("#mute-unmute > span").addClass("fa-volume-off");$("#mute-unmute > span").removeClass("fa-volume-up");$("#mute-unmute > span").removeClass("fa-volume-down")}else{if(m[0].volume<0.5){$("#mute-unmute > span").addClass("fa-volume-down");$("#mute-unmute > span").removeClass("fa-volume-off");$("#mute-unmute > span").removeClass("fa-volume-up")}else{$("#mute-unmute > span").addClass("fa-volume-up");$("#mute-unmute > span").removeClass("fa-volume-off");$("#mute-unmute > span").removeClass("fa-volume-down")}}});m[0].addEventListener("loadedmetadata",function(){if(f.seekTime!=-1){m[0].currentTime=f.seekTime/1000;f.seekTime=-1}else{if(f.videos[f.currentItem].starttime!=0){m[0].currentTime=f.videos[f.currentItem].starttime/1000}}if(f.wasPlaying&&m[0].paused){m[0].play()}f.wasPlaying=false});$("#play-pause").click(function(){if(m[0].paused==true){m[0].play()}else{m[0].pause()}});$("#mute-unmute").click(function(){if(m[0].muted==true){m[0].muted=false;$("#volume-bar").val(d)}else{m[0].muted=true;d=$("#volume-bar").val();$("#volume-bar").val(0)}});$("#volume-bar").on("change mousemove",function(){m[0].volume=$(this).val();if($(this).val()>0&&m[0].muted==true){m[0].muted=false}});$("#seek-bar").on("change",function(){var p=$(this).val();var q=0;for(var q=0;q<f.videos.length;q++){p-=f.videos[q].duration==-1?f.videos[q].oduration:f.videos[q].duration;if(p<0){p+=f.videos[q].duration==-1?f.videos[q].oduration:f.videos[q].duration;if(f.currentItem==q){if(f.videos[f.currentItem].starttime!=0){m[0].currentTime=(f.videos[f.currentItem].starttime/1000)+(p/1000)}else{m[0].currentTime=p/1000}if(f.wasPlaying&&m[0].paused){m[0].play()}f.wasPlaying=false}else{f.currentItem=q;f.seekTime=f.videos[q].starttime!=0?f.videos[f.currentItem].starttime+p:p;i(m)}break}}});$("#seek-bar").on("input",function(){if(!m[0].paused&&!m[0].ended){f.wasPlaying=true;m[0].pause()}$("#playtime").text(formatTime($(this).val()/1000))});$("#fullscreen").click(function(){toggleFullScreen()});$(window).on("resize",function(){m.width($("#videoplayer").parent().width());m.height($("#videoplayer").parent().height());$(".playIcon").css("left",(($("#videoplayer").width()/2)-($(".playIcon").width()/2))+"px");$(".playIcon").css("top",(($("#videoplayer").height()/2)-($(".playIcon").height()/2))+"px");$("#seek-bar").css("width",($("#videoplayer").parent().width()-325)+"px")});return m};var e=function(){currentSource=f.videos[f.currentItem].sources[f.videos[f.currentItem].sources.length-1];
return currentSource};var g=function(l,m){return $.grep(l,function(n){if(n.type==m){return n}})[0]};var c=function(){query="?ticket="+f.ticket;return query};var i=function(n){var m=e();var o=g(m.codecs,"video/mp4");if(f.currentItem==0){n.removeAttr("autoplay");b=0}else{n.attr("autoplay","autoplay");for(var l=0;l<f.currentItem;l++){b+=f.videos[l].duration==-1?f.videos[l].oduration:f.videos[l].duration}}n.children("source").first().attr("src",o.src+c());n.load()};var h=function(){f.currentOrder=f.order.desktop;if($.browser.mobile){f.currentOrder=f.order.mobile}};h();return j};return a});function toggleFullScreen(){if(!document.fullscreenElement&&!document.mozFullScreenElement&&!document.webkitFullscreenElement&&!document.msFullscreenElement){if(document.documentElement.requestFullscreen){document.documentElement.requestFullscreen()}else{if(document.documentElement.msRequestFullscreen){document.documentElement.msRequestFullscreen()}else{if(document.documentElement.mozRequestFullScreen){document.documentElement.mozRequestFullScreen()}else{if(document.documentElement.webkitRequestFullscreen){document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}}}}$("#fullscreen > span").addClass("fa-compress");$("#fullscreen > span").removeClass("fa-expand")}else{if(document.exitFullscreen){document.exitFullscreen()}else{if(document.msExitFullscreen){document.msExitFullscreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else{if(document.webkitExitFullscreen){document.webkitExitFullscreen()}}}}$("#fullscreen > span").addClass("fa-expand");$("#fullscreen > span").removeClass("fa-compress")}}function formatTime(c){var a,b,d;a=Math.floor(c/3600);b=Math.floor((c%3600)/60);d=Math.floor((c%60));formattedTime="";if(a>0){if(a<10){formattedTime+="0"}formattedTime+=a+":"}if(b<10){formattedTime+="0"}formattedTime+=b+":";if(d<10){formattedTime+="0"}formattedTime+=d;return formattedTime};