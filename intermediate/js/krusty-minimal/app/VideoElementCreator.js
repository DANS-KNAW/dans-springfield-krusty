define(["libs/jquery.browser.mobile","libs/contextmenu/jquery.contextMenu.min","libs/contextmenu/jquery.ui.position.min","libs/jquery.cookie-1.4.1.min",],function(){var a=function(q){var p={};var g={videos:null,quality:"360p",currentOrder:null,currentItem:0,order:{mobile:["360p","180p","720p","1080p"],desktop:["720p","1080p","720p","1080p"]},ticket:null,starttime:0,wasPlaying:false,seekTime:-1,playMode:null};var e=0;var d=0;var m=false;var k="";$.extend(g,q);p.create=function(){var t=$(document.createElement("video"));t.attr("id","videoplayer");if(g.starttime>0){h()}var r=f(g);var x=i(r.codecs,"video/mp4");if(x.streamSrc!==undefined){var y=$(document.createElement("source"));y.attr("src",x.streamSrc);y.attr("type",x.type);t.append(y)}r=$(document.createElement("source"));r.attr("src",x.src+c());r.attr("type",x.type);t.append(r);if(g.playMode=="menu"){l()}var w=b();if(w!=undefined&&w.length>0){$("#subtitles").show();var s={};for(var v=0;v<w.length;v++){var z={};var u=$(document.createElement("track"));u.attr("src",w[v].subtitle);u.attr("kind","subtitles");if(w[v].language!=undefined){z.name=languageArray[w[v].language];u.attr("srclang",w[v].language);u.attr("label",languageArray[w[v].language]);if($.cookie("subtitles")=="true"&&$.cookie("language")==w[v].language){u.attr("default","default");$("#subtitles > span").addClass("subtitles-enabled");$("#subtitles > span").removeClass("subtitles-crossed-out");z.icon="fa-check";m=true;k=w[v].language}}else{}t.append(u);s[w[v].language]=z}var z={};z.name="Disabled";if($.cookie("subtitles")!="true"){z.icon="fa-check"}s.disabled=z;if(w.length>1){jQuery.contextMenu({selector:"#subtitles",trigger:"left",build:function(A,B){return{callback:function(D,C){$(t.prop("textTracks")).prop("mode",function(){s[this.language].icon="";if(this.language==D){s[this.language].icon="fa-check";s.disabled.icon=""}return this.language==D?"showing":"disabled"});if(D=="disabled"){s.disabled.icon="fa-check";$.cookie("subtitles","false");m=false;$("#subtitles > span").removeClass("subtitles-enabled");$("#subtitles > span").addClass("subtitles-crossed-out")}else{m=true;k=D;$.cookie("subtitles","true");$.cookie("language",D);$("#subtitles > span").addClass("subtitles-enabled");$("#subtitles > span").removeClass("subtitles-crossed-out")}},items:s}}})}}else{$("#subtitles").hide()}t.on("ended",function(){if(g.playMode=="menu"){$("#menu").show()}else{g.currentItem=g.currentItem<g.videos.length-1?g.currentItem+1:0;o(t)}});$("#seek-bar").attr("max",g.videos.duration);$("#playtime").text(formatTime(0));$("#totaltime").text(formatTime(g.videos.duration/1000));t.on("play",function(){$("#play-pause > span").addClass("fa-pause");$("#play-pause > span").removeClass("fa-play")});t.on("pause",function(){$("#play-pause > span").addClass("fa-play");$("#play-pause > span").removeClass("fa-pause")});t.on("timeupdate",function(){if(g.playMode=="menu"){var A=(this.currentTime*1000)-g.videos[g.currentItem].starttime;if(A<0){A=0}$("#playtime").text(formatTime(A/1000));$("#seek-bar").val(A)}else{var A=(this.currentTime*1000)-g.videos[g.currentItem].starttime;if(A<0){A=0}$("#playtime").text(formatTime((d/1000)+A/1000));$("#seek-bar").val(d+A);if(g.videos[g.currentItem].duration!=-1&&A>=g.videos[g.currentItem].duration){g.currentItem=g.currentItem<g.videos.length-1?g.currentItem+1:0;o(t)}}});t[0].addEventListener("volumechange",function(){if(t[0].muted==true||t[0].volume==0){$("#mute-unmute > span").addClass("fa-volume-off");$("#mute-unmute > span").removeClass("fa-volume-up");$("#mute-unmute > span").removeClass("fa-volume-down")}else{if(t[0].volume<0.5){$("#mute-unmute > span").addClass("fa-volume-down");$("#mute-unmute > span").removeClass("fa-volume-off");$("#mute-unmute > span").removeClass("fa-volume-up")}else{$("#mute-unmute > span").addClass("fa-volume-up");$("#mute-unmute > span").removeClass("fa-volume-off");$("#mute-unmute > span").removeClass("fa-volume-down")}}});t[0].addEventListener("loadedmetadata",function(){if(g.seekTime!=-1){t[0].currentTime=g.seekTime/1000;
g.seekTime=-1}else{if(g.videos[g.currentItem].starttime!=0){t[0].currentTime=g.videos[g.currentItem].starttime/1000}}if(g.wasPlaying&&t[0].paused){t[0].play()}g.wasPlaying=false});$("#play-pause").click(function(){if(t[0].paused==true){t[0].play()}else{t[0].pause()}});$("#mute-unmute").click(function(){if(t[0].muted==true){t[0].muted=false;$("#volume-bar").val(e)}else{t[0].muted=true;e=$("#volume-bar").val();$("#volume-bar").val(0)}});$("#volume-bar").on("change mousemove",function(){t[0].volume=$(this).val();if($(this).val()>0&&t[0].muted==true){t[0].muted=false}});$("#seek-bar").on("change",function(){var A=$(this).val();if(g.playMode=="menu"){if(g.videos[g.currentItem].starttime!=0){t[0].currentTime=(g.videos[g.currentItem].starttime/1000)+(A/1000)}else{t[0].currentTime=A/1000}if(g.wasPlaying&&t[0].paused){t[0].play()}g.wasPlaying=false}else{var B=0;for(var B=0;B<g.videos.length;B++){A-=g.videos[B].duration==-1?g.videos[B].oduration:g.videos[B].duration;if(A<0){A+=g.videos[B].duration==-1?g.videos[B].oduration:g.videos[B].duration;if(g.currentItem==B){if(g.videos[g.currentItem].starttime!=0){t[0].currentTime=(g.videos[g.currentItem].starttime/1000)+(A/1000)}else{t[0].currentTime=A/1000}if(g.wasPlaying&&t[0].paused){t[0].play()}g.wasPlaying=false}else{g.currentItem=B;g.seekTime=g.videos[B].starttime!=0?g.videos[g.currentItem].starttime+A:A;o(t)}break}}}});$("#seek-bar").on("input",function(){if(!t[0].paused&&!t[0].ended){g.wasPlaying=true;t[0].pause()}$("#playtime").text(formatTime($(this).val()/1000))});$("#fullscreen").click(function(){toggleFullScreen()});$("#subtitles").click(function(A){var B=b();if(B.length==1){n()}});$(window).on("resize",function(){t.width($("#videoplayer").parent().width());t.height($("#videoplayer").parent().height());$(".playIcon").css("left",(($("#videoplayer").width()/2)-($(".playIcon").width()/2))+"px");$(".playIcon").css("top",(($("#videoplayer").height()/2)-($(".playIcon").height()/2))+"px");var A=325;var B=b();if(B!=undefined&&B.length>0){A+=20}if(g.playMode=="menu"){A+=20}$("#seek-bar").css("width",($("#videoplayer").parent().width()-A)+"px")});$("body").on("click",".menuitem",function(A){var C=A.target.id.substr(A.target.id.indexOf("_")+1);g.currentItem=C;var B=g.videos[C].duration==-1?g.videos[C].oduration:g.videos[C].duration;$("#seek-bar").attr("max",B-g.videos[C].starttime);$("#playtime").text(formatTime(0));$("#totaltime").text(formatTime((B-g.videos[C].starttime)/1000));$("#menu").hide();o(t);t[0].currentTime=0;t[0].play()});$("body").on("click","#menuicon",function(){t[0].pause();$("#menu").show()});return t};var f=function(){currentSource=g.videos[g.currentItem].sources[g.videos[g.currentItem].sources.length-1];return currentSource};var i=function(r,s){return $.grep(r,function(t){if(t.type==s){return t}})[0]};var c=function(){query="";if(g.ticket!=null){query="?ticket="+g.ticket}return query};var b=function(){return g.videos[g.currentItem].subtitles};var o=function(x){var v=f();var y=i(v.codecs,"video/mp4");if(g.currentItem==0){x.removeAttr("autoplay");d=0}else{x.attr("autoplay","autoplay");for(var u=0;u<g.currentItem;u++){d+=g.videos[u].duration==-1?g.videos[u].oduration:g.videos[u].duration}}x.children("source").first().attr("src",y.src+c());var z=b();if(z!=undefined&&z.length>0){jQuery.contextMenu("destroy");$(x.children("track").remove());$("#subtitles").show();var t={};for(var u=0;u<z.length;u++){var w={};var r=$(document.createElement("track"));r.attr("src",z[u].subtitle);r.attr("kind","subtitles");if(z[u].language!=undefined){w.name=languageArray[z[u].language];r.attr("srclang",z[u].language);r.attr("label",languageArray[z[u].language]);if(m&&k==z[u].language){w.icon="fa-check";r.attr("default","default")}}else{}x.append(r);t[z[u].language]=w}var w={};w.name="Disabled";if(!m){w.icon="fa-check"}t.disabled=w;if(z.length>1){if(navigator.userAgent.search("Firefox")>-1){$(x.prop("textTracks")).prop("mode",function(){return this.language==k?"showing":"disabled"})}jQuery.contextMenu({selector:"#subtitles",trigger:"left",build:function(s,A){return{callback:function(C,B){$(x.prop("textTracks")).prop("mode",function(){t[this.language].icon="";
if(this.language==C){t[this.language].icon="fa-check";t.disabled.icon=""}return this.language==C?"showing":"disabled"});if(C=="disabled"){t.disabled.icon="fa-check";$.cookie("subtitles","false");m=false;$("#subtitles > span").removeClass("subtitles-enabled");$("#subtitles > span").addClass("subtitles-crossed-out")}else{m=true;k=C;$.cookie("subtitles","true");$.cookie("language",C);$("#subtitles > span").addClass("subtitles-enabled");$("#subtitles > span").removeClass("subtitles-crossed-out")}},items:t}}})}else{if(z.length==1){if(m&&navigator.userAgent.search("Firefox")>-1){$(x.prop("textTracks")).first().prop("mode","showing")}}}}else{jQuery.contextMenu("destroy");$("#subtitles").hide()}x.load()};var j=function(){g.currentOrder=g.order.desktop;if($.browser.mobile){g.currentOrder=g.order.mobile}};var l=function(){var t=$(document.createElement("div"));t.attr("id","menu");for(var r=0;r<g.videos.length;r++){var s=$(document.createElement("div"));s.attr("id","videoitem_"+r);s.attr("class","menuitem");s.text(g.videos[r].title);t.append(s)}$("body").append(t)};var n=function(){var r=document.getElementById("videoplayer");if(r.textTracks[0].mode=="showing"){m=false;$.cookie("subtitles","false");r.textTracks[0].mode="hidden";$("#subtitles > span").removeClass("subtitles-enabled");$("#subtitles > span").addClass("subtitles-crossed-out")}else{m=true;$.cookie("subtitles","true");r.textTracks[0].mode="showing";$("#subtitles > span").removeClass("subtitles-crossed-out");$("#subtitles > span").addClass("subtitles-enabled")}};var h=function(){var s=g.starttime*1000;d=0;for(var r=0;r<g.videos.length;r++){s-=g.videos[r].duration==-1?g.videos[r].oduration:g.videos[r].duration;if(s<0){g.currentItem=r;s+=g.videos[r].duration==-1?g.videos[r].oduration:g.videos[r].duration;g.seekTime=g.videos[r].starttime!=0?g.videos[g.currentItem].starttime+s:s}else{d+=g.videos[r].duration==-1?g.videos[r].oduration:g.videos[r].duration}}};j();return p};return a});function toggleFullScreen(){if(!document.fullscreenElement&&!document.mozFullScreenElement&&!document.webkitFullscreenElement&&!document.msFullscreenElement){if(document.documentElement.requestFullscreen){document.documentElement.requestFullscreen()}else{if(document.documentElement.msRequestFullscreen){document.documentElement.msRequestFullscreen()}else{if(document.documentElement.mozRequestFullScreen){document.documentElement.mozRequestFullScreen()}else{if(document.documentElement.webkitRequestFullscreen){document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}}}}$("#fullscreen > span").addClass("fa-compress");$("#fullscreen > span").removeClass("fa-expand")}else{if(document.exitFullscreen){document.exitFullscreen()}else{if(document.msExitFullscreen){document.msExitFullscreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else{if(document.webkitExitFullscreen){document.webkitExitFullscreen()}}}}$("#fullscreen > span").addClass("fa-expand");$("#fullscreen > span").removeClass("fa-compress")}}function formatTime(c){var a,b,d;a=Math.floor(c/3600);b=Math.floor((c%3600)/60);d=Math.floor((c%60));formattedTime="";if(a>0){if(a<10){formattedTime+="0"}formattedTime+=a+":"}if(b<10){formattedTime+="0"}formattedTime+=b+":";if(d<10){formattedTime+="0"}formattedTime+=d;return formattedTime}var languageArray={am:"አማርኛ",ar:"العربية",ast:"asturianu",az:"azərbaycanca",bg:"български",br:"brezhoneg",bs:"bosanski",ca:"català",co:"corsu",cs:"čeština",da:"dansk",de:"Deutsch",el:"Ελληνικά",en:"English",eo:"Esperanto",es:"español",et:"eesti",eu:"euskara",fi:"suomi",fr:"français",fy:"Frysk",gl:"galego",gcf:"Kréyòl gwadloupéyen",he:"עברית",hr:"hrvatski",hu:"magyar",id:"Bahasa Indonesia",is:"íslenska",it:"italiano",ja:"日本語",ko:"한국어",lb:"Lëtzebuergesch",lt:"lietuvių",lv:"latviešu",mk:"македонски",nl:"Nederlands",nn:"norsk nynorsk",no:"norsk bokmål",pl:"polski",pt:"português","pt-br":"português do Brasil",ro:"română","ro-md":"молдовеняскэ",ru:"русский",sk:"slovenčina",sl:"slovenščina",sq:"shqip",sv:"svenska",tr:"Türkçe",uk:"українська",vi:"Tiếng Việt","zh-hans":"中文（简体）","zh-hant":"中文（繁體）","zh-tw":"中文（台灣）"};