define(["libs/jquery.browser.mobile","config/BaseConfig",],function(c,b){var a=function(m){var l={};var h={videos:null,quality:"360p",currentOrder:null,currentItem:0,order:{mobile:["360p","180p","720p","1080p"],desktop:["720p","1080p","720p","1080p"]},ticket:null,wasPlaying:false,seekTime:-1};var f=0;var d=0;$.extend(h,m);l.create=function(){var o=$(document.createElement("video"));o.attr("id","videoplayer");if(b.autoplay){o.attr("autoplay","autoplay")}var q=g(h);var p=i(q.codecs,"video/mp4");if(p.streamSrc!==undefined){var n=$(document.createElement("source"));n.attr("src",p.streamSrc);n.attr("type",p.type);o.append(n)}q=$(document.createElement("source"));q.attr("src",p.src+e());q.attr("type",p.type);o[0].addEventListener("error",function(){$("body").append("<div class='error'>You don't have valid credentials to play this video.</div>")});o.append(q);o.on("ended",function(){h.currentItem=h.currentItem<h.videos.length-1?h.currentItem+1:0;k(o)});$("#seek-bar").attr("max",h.videos.duration);$("#playtime").text(formatTime(0));$("#totaltime").text(formatTime(h.videos.duration/1000));o.on("play",function(){$("#play-pause > span").addClass("fa-pause");$("#play-pause > span").removeClass("fa-play")});o.on("pause",function(){$("#play-pause > span").addClass("fa-play");$("#play-pause > span").removeClass("fa-pause")});o.on("timeupdate",function(){var r=(this.currentTime*1000)-h.videos[h.currentItem].starttime;if(r<0){r=0}$("#playtime").text(formatTime((d/1000)+r/1000));$("#seek-bar").val(d+r);if(h.videos[h.currentItem].duration!=-1&&r>=h.videos[h.currentItem].duration){h.currentItem=h.currentItem<h.videos.length-1?h.currentItem+1:0;k(o)}});o[0].addEventListener("volumechange",function(){if(o[0].muted==true||o[0].volume==0){$("#mute-unmute > span").addClass("fa-volume-off");$("#mute-unmute > span").removeClass("fa-volume-up");$("#mute-unmute > span").removeClass("fa-volume-down")}else{if(o[0].volume<0.5){$("#mute-unmute > span").addClass("fa-volume-down");$("#mute-unmute > span").removeClass("fa-volume-off");$("#mute-unmute > span").removeClass("fa-volume-up")}else{$("#mute-unmute > span").addClass("fa-volume-up");$("#mute-unmute > span").removeClass("fa-volume-off");$("#mute-unmute > span").removeClass("fa-volume-down")}}});o[0].addEventListener("loadedmetadata",function(){if(h.seekTime!=-1){o[0].currentTime=h.seekTime/1000;h.seekTime=-1}else{if(h.videos[h.currentItem].starttime!=0){o[0].currentTime=h.videos[h.currentItem].starttime/1000}}if(h.wasPlaying&&o[0].paused){o[0].play()}h.wasPlaying=false});$("#play-pause").click(function(){if(o[0].paused==true){o[0].play()}else{o[0].pause()}});$("#mute-unmute").click(function(){if(o[0].muted==true){o[0].muted=false;$("#volume-bar").val(f)}else{o[0].muted=true;f=$("#volume-bar").val();$("#volume-bar").val(0)}});$("#volume-bar").on("change mousemove",function(){o[0].volume=$(this).val();if($(this).val()>0&&o[0].muted==true){o[0].muted=false}});$("#seek-bar").on("change",function(){var r=$(this).val();var s=0;for(var s=0;s<h.videos.length;s++){r-=h.videos[s].duration==-1?h.videos[s].oduration:h.videos[s].duration;if(r<0){r+=h.videos[s].duration==-1?h.videos[s].oduration:h.videos[s].duration;if(h.currentItem==s){if(h.videos[h.currentItem].starttime!=0){o[0].currentTime=(h.videos[h.currentItem].starttime/1000)+(r/1000)}else{o[0].currentTime=r/1000}if(h.wasPlaying&&o[0].paused){o[0].play()}h.wasPlaying=false}else{h.currentItem=s;h.seekTime=h.videos[s].starttime!=0?h.videos[h.currentItem].starttime+r:r;k(o)}break}}});$("#seek-bar").on("input",function(){if(!o[0].paused&&!o[0].ended){h.wasPlaying=true;o[0].pause()}$("#playtime").text(formatTime($(this).val()/1000))});$("#fullscreen").click(function(){toggleFullScreen()});$(window).on("resize",function(){o.width($("#videoplayer").parent().width());o.height($("#videoplayer").parent().height());$(".playIcon").css("left",(($("#videoplayer").width()/2)-($(".playIcon").width()/2))+"px");$(".playIcon").css("top",(($("#videoplayer").height()/2)-($(".playIcon").height()/2))+"px");
$("#seek-bar").css("width",($("#videoplayer").parent().width()-325)+"px")});return o};var g=function(){currentSource=h.videos[h.currentItem].sources[h.videos[h.currentItem].sources.length-1];return currentSource};var i=function(n,o){return $.grep(n,function(p){if(p.type==o){return p}})[0]};var e=function(){query="?ticket="+h.ticket;return query};var k=function(p){var o=g();var q=i(o.codecs,"video/mp4");d=0;if(h.currentItem==0){p.removeAttr("autoplay");$("#play-pause > span").addClass("fa-play");$("#play-pause > span").removeClass("fa-pause")}else{p.attr("autoplay","autoplay");for(var n=0;n<h.currentItem;n++){d+=h.videos[n].duration==-1?h.videos[n].oduration:h.videos[n].duration}}p.children("source").first().attr("src",q.src+e());p.load()};var j=function(){h.currentOrder=h.order.desktop;if($.browser.mobile){h.currentOrder=h.order.mobile}};j();return l};return a});function toggleFullScreen(){if(!document.fullscreenElement&&!document.mozFullScreenElement&&!document.webkitFullscreenElement&&!document.msFullscreenElement){if(document.documentElement.requestFullscreen){document.documentElement.requestFullscreen()}else{if(document.documentElement.msRequestFullscreen){document.documentElement.msRequestFullscreen()}else{if(document.documentElement.mozRequestFullScreen){document.documentElement.mozRequestFullScreen()}else{if(document.documentElement.webkitRequestFullscreen){document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}}}}$("#fullscreen > span").addClass("fa-compress");$("#fullscreen > span").removeClass("fa-expand")}else{if(document.exitFullscreen){document.exitFullscreen()}else{if(document.msExitFullscreen){document.msExitFullscreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else{if(document.webkitExitFullscreen){document.webkitExitFullscreen()}}}}$("#fullscreen > span").addClass("fa-expand");$("#fullscreen > span").removeClass("fa-compress")}}function formatTime(c){var a,b,d;a=Math.floor(c/3600);b=Math.floor((c%3600)/60);d=Math.floor((c%60));formattedTime="";if(a>0){if(a<10){formattedTime+="0"}formattedTime+=a+":"}if(b<10){formattedTime+="0"}formattedTime+=b+":";if(d<10){formattedTime+="0"}formattedTime+=d;return formattedTime};