define(["libs/jquery.browser.mobile","libs/contextmenu/jquery.contextMenu.min","libs/contextmenu/jquery.ui.position.min",],function(){var a=function(p){var o={};var h={audios:null,currentItem:0,ticket:null,starttime:0,wasPlaying:false,seekTime:-1,playMode:null};var f=0;var d=0;var m=false;var j="";$.extend(h,p);o.create=function(){var t=$(document.createElement("audio"));t.attr("id","videoplayer");if(h.starttime>0){k()}var q=g(h);var w=i(q.codecs,"audio/mp4");if(w.streamSrc!==undefined){var x=$(document.createElement("source"));x.attr("src",w.streamSrc);x.attr("type",w.type);t.append(x)}q=$(document.createElement("source"));q.attr("src",w.src+c());q.attr("type",w.type);t.append(q);if(h.playMode=="menu"){l()}var v=b();if(v!=undefined&&v.length>0){$("#subtitles").show();var r={};for(var u=0;u<v.length;u++){var y={};var s=$(document.createElement("track"));s.attr("src",v[u].subtitle);s.attr("kind","subtitles");if(v[u].language!=undefined){y.name=languageArray[v[u].language];s.attr("srclang",v[u].language);s.attr("label",languageArray[v[u].language]);if($.cookie("subtitles")=="true"&&$.cookie("language")==v[u].language){s.attr("default","default");$("#subtitles > span").addClass("subtitles-enabled");$("#subtitles > span").removeClass("subtitles-crossed-out");y.icon="fa-check";m=true;j=v[u].language}}else{}t.append(s);r[v[u].language]=y}var y={};y.name="Disabled";if($.cookie("subtitles")!="true"){y.icon="fa-check"}r.disabled=y;if(v.length>1){jQuery.contextMenu({selector:"#subtitles",trigger:"left",build:function(z,A){return{callback:function(C,B){$(t.prop("textTracks")).prop("mode",function(){r[this.language].icon="";if(this.language==C){r[this.language].icon="fa-check";r.disabled.icon=""}return this.language==C?"showing":"disabled"});if(C=="disabled"){r.disabled.icon="fa-check";$.cookie("subtitles","false");m=false;$("#subtitles > span").removeClass("subtitles-enabled");$("#subtitles > span").addClass("subtitles-crossed-out")}else{m=true;j=C;$.cookie("subtitles","true");$.cookie("language",C);$("#subtitles > span").addClass("subtitles-enabled");$("#subtitles > span").removeClass("subtitles-crossed-out")}},items:r}}})}}else{$("#subtitles").hide()}$("#fullscreen").hide();t.on("ended",function(){if(h.playMode=="menu"){$("#menu").show()}else{h.currentItem=h.currentItem<h.audios.length-1?h.currentItem+1:0;e(t)}});$("#seek-bar").attr("max",h.audios.duration);$("#playtime").text(formatTime(0));$("#totaltime").text(formatTime(h.audios.duration/1000));t.on("play",function(){$("#play-pause > span").addClass("fa-pause");$("#play-pause > span").removeClass("fa-play")});t.on("pause",function(){$("#play-pause > span").addClass("fa-play");$("#play-pause > span").removeClass("fa-pause")});t.on("timeupdate",function(){if(h.playMode=="menu"){var z=(this.currentTime*1000)-h.audios[h.currentItem].starttime;if(z<0){z=0}$("#playtime").text(formatTime(z/1000));$("#seek-bar").val(z)}else{var z=(this.currentTime*1000)-h.audios[h.currentItem].starttime;if(z<0){z=0}$("#playtime").text(formatTime((d/1000)+z/1000));$("#seek-bar").val(d+z);if(h.audios[h.currentItem].duration!=-1&&z>=h.audios[h.currentItem].duration){h.currentItem=h.currentItem<h.audios.length-1?h.currentItem+1:0;e(t)}}});t[0].addEventListener("volumechange",function(){if(t[0].muted==true||t[0].volume==0){$("#mute-unmute > span").addClass("fa-volume-off");$("#mute-unmute > span").removeClass("fa-volume-up");$("#mute-unmute > span").removeClass("fa-volume-down")}else{if(t[0].volume<0.5){$("#mute-unmute > span").addClass("fa-volume-down");$("#mute-unmute > span").removeClass("fa-volume-off");$("#mute-unmute > span").removeClass("fa-volume-up")}else{$("#mute-unmute > span").addClass("fa-volume-up");$("#mute-unmute > span").removeClass("fa-volume-off");$("#mute-unmute > span").removeClass("fa-volume-down")}}});t[0].addEventListener("loadedmetadata",function(){if(h.seekTime!=-1){t[0].currentTime=h.seekTime/1000;h.seekTime=-1}else{if(h.audios[h.currentItem].starttime!=0){t[0].currentTime=h.audios[h.currentItem].starttime/1000
}}if(h.wasPlaying&&t[0].paused){t[0].play()}h.wasPlaying=false});$("#play-pause").click(function(){if(t[0].paused==true){t[0].play()}else{t[0].pause()}});$("#mute-unmute").click(function(){if(t[0].muted==true){t[0].muted=false;$("#volume-bar").val(f)}else{t[0].muted=true;f=$("#volume-bar").val();$("#volume-bar").val(0)}});$("#volume-bar").on("change mousemove",function(){t[0].volume=$(this).val();if($(this).val()>0&&t[0].muted==true){t[0].muted=false}});$("#seek-bar").on("change",function(){var z=$(this).val();if(h.playMode=="menu"){if(h.audios[h.currentItem].starttime!=0){t[0].currentTime=(h.audios[h.currentItem].starttime/1000)+(z/1000)}else{t[0].currentTime=z/1000}if(h.wasPlaying&&t[0].paused){t[0].play()}h.wasPlaying=false}else{var A=0;for(var A=0;A<h.audios.length;A++){z-=h.audios[A].duration==-1?h.audios[A].oduration:h.audios[A].duration;if(z<0){z+=h.audios[A].duration==-1?h.audios[A].oduration:h.audios[A].duration;if(h.currentItem==A){if(h.audios[h.currentItem].starttime!=0){t[0].currentTime=(h.audios[h.currentItem].starttime/1000)+(z/1000)}else{t[0].currentTime=z/1000}if(h.wasPlaying&&t[0].paused){t[0].play()}h.wasPlaying=false}else{h.currentItem=A;h.seekTime=h.audios[A].starttime!=0?h.audios[h.currentItem].starttime+z:z;e(t)}break}}}});$("#seek-bar").on("input",function(){if(!t[0].paused&&!t[0].ended){h.wasPlaying=true;t[0].pause()}$("#playtime").text(formatTime($(this).val()/1000))});$("#fullscreen").click(function(){toggleFullScreen()});$("#subtitles").click(function(z){var A=b();if(A.length==1){n()}});$(window).on("resize",function(){t.width($("#videoplayer").parent().width());t.height($("#videoplayer").parent().height());$(".playIcon").css("left",(($("#videoplayer").width()/2)-($(".playIcon").width()/2))+"px");$(".playIcon").css("top",(($("#videoplayer").height()/2)-($(".playIcon").height()/2))+"px");var z=325;var A=b();if(A!=undefined&&A.length>0){z+=20}if(h.playMode=="menu"){z+=20}$("#seek-bar").css("width",($("#videoplayer").parent().width()-z)+"px")});$("body").on("click",".menuitem",function(z){var B=z.target.id.substr(z.target.id.indexOf("_")+1);h.currentItem=B;var A=h.audios[B].duration==-1?h.audios[B].oduration:h.audios[B].duration;$("#seek-bar").attr("max",A-h.audios[B].starttime);$("#playtime").text(formatTime(0));$("#totaltime").text(formatTime((A-h.audios[B].starttime)/1000));$("#menu").hide();e(t);t[0].currentTime=0;t[0].play()});$("body").on("click","#menuicon",function(){t[0].pause();$("#menu").show()});return t};var g=function(){currentSource=h.audios[h.currentItem].sources[h.audios[h.currentItem].sources.length-1];return currentSource};var i=function(q,r){return $.grep(q,function(s){if(s.type==r){return s}})[0]};var c=function(){query="";if(h.ticket!=null){query="?ticket="+h.ticket}return query};var b=function(){return h.audios[h.currentItem].subtitles};var e=function(w){var u=g();var x=i(u.codecs,"audio/mp4");if(h.currentItem==0){w.removeAttr("autoplay");d=0}else{w.attr("autoplay","autoplay");for(var t=0;t<h.currentItem;t++){d+=h.audios[t].duration==-1?h.audios[t].oduration:h.audios[t].duration}}w.children("source").first().attr("src",x.src+c());var y=b();if(y!=undefined&&y.length>0){jQuery.contextMenu("destroy");w.children("track").remove();$("#subtitles").show();var r={};for(var t=0;t<y.length;t++){var v={};var q=$(document.createElement("track"));q.attr("src",y[t].subtitle);q.attr("kind","subtitles");if(y[t].language!=undefined){v.name=languageArray[y[t].language];q.attr("srclang",y[t].language);q.attr("label",languageArray[y[t].language]);if(m&&j==y[t].language){v.icon="fa-check";q.attr("default","default")}}else{}w.append(q);r[y[t].language]=v}var v={};v.name="Disabled";if(!m){v.icon="fa-check"}r.disabled=v;if(y.length>1){if(navigator.userAgent.search("Firefox")>-1){$(w.prop("textTracks")).prop("mode",function(){return this.language==j?"showing":"disabled"})}jQuery.contextMenu({selector:"#subtitles",trigger:"left",build:function(s,z){return{callback:function(B,A){$(w.prop("textTracks")).prop("mode",function(){r[this.language].icon="";
if(this.language==B){r[this.language].icon="fa-check";r.disabled.icon=""}return this.language==B?"showing":"disabled"});if(B=="disabled"){r.disabled.icon="fa-check";$.cookie("subtitles","false");m=false;$("#subtitles > span").removeClass("subtitles-enabled");$("#subtitles > span").addClass("subtitles-crossed-out")}else{m=true;j=B;$.cookie("subtitles","true");$.cookie("language",B);$("#subtitles > span").addClass("subtitles-enabled");$("#subtitles > span").removeClass("subtitles-crossed-out")}},items:r}}})}else{if(y.length==1){if(m&&navigator.userAgent.search("Firefox")>-1){$(w.prop("textTracks")).first().prop("mode","showing")}}}}else{jQuery.contextMenu("destroy");$("#subtitles").hide()}w.load()};var l=function(){var s=$(document.createElement("div"));s.attr("id","menu");for(var q=0;q<h.audios.length;q++){var r=$(document.createElement("div"));r.attr("id","audioitem_"+q);r.attr("class","menuitem");r.text(h.audios[q].title);s.append(r)}$("body").append(s)};var n=function(){var q=document.getElementById("videoplayer");if(q.textTracks[0].mode=="showing"){m=false;$.cookie("subtitles","false");q.textTracks[0].mode="hidden";$("#subtitles > span").removeClass("subtitles-enabled");$("#subtitles > span").addClass("subtitles-crossed-out")}else{m=true;$.cookie("subtitles","true");q.textTracks[0].mode="showing";$("#subtitles > span").removeClass("subtitles-crossed-out");$("#subtitles > span").addClass("subtitles-enabled")}};var k=function(){var r=h.starttime*1000;for(var q=0;q<h.audios.length;q++){r-=h.audios[q].duration==-1?h.audios[q].oduration:h.audios[q].duration;if(r<0){h.currentItem=q;r+=h.audios[q].duration==-1?h.audios[q].oduration:h.audios[q].duration;h.seekTime=h.audios[q].starttime!=0?h.audios[h.currentItem].starttime+r:r}else{d+=h.audios[q].duration==-1?h.audios[q].oduration:h.audios[q].duration}}};return o};return a});function toggleFullScreen(){if(!document.fullscreenElement&&!document.mozFullScreenElement&&!document.webkitFullscreenElement&&!document.msFullscreenElement){if(document.documentElement.requestFullscreen){document.documentElement.requestFullscreen()}else{if(document.documentElement.msRequestFullscreen){document.documentElement.msRequestFullscreen()}else{if(document.documentElement.mozRequestFullScreen){document.documentElement.mozRequestFullScreen()}else{if(document.documentElement.webkitRequestFullscreen){document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}}}}$("#fullscreen > span").addClass("fa-compress");$("#fullscreen > span").removeClass("fa-expand")}else{if(document.exitFullscreen){document.exitFullscreen()}else{if(document.msExitFullscreen){document.msExitFullscreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else{if(document.webkitExitFullscreen){document.webkitExitFullscreen()}}}}$("#fullscreen > span").addClass("fa-expand");$("#fullscreen > span").removeClass("fa-compress")}}function formatTime(c){var a,b,d;a=Math.floor(c/3600);b=Math.floor((c%3600)/60);d=Math.floor((c%60));formattedTime="";if(a>0){if(a<10){formattedTime+="0"}formattedTime+=a+":"}if(b<10){formattedTime+="0"}formattedTime+=b+":";if(d<10){formattedTime+="0"}formattedTime+=d;return formattedTime}var languageArray={am:"አማርኛ",ar:"العربية",ast:"asturianu",az:"azərbaycanca",bg:"български",br:"brezhoneg",bs:"bosanski",ca:"català",co:"corsu",cs:"čeština",da:"dansk",de:"Deutsch",el:"Ελληνικά",en:"English",eo:"Esperanto",es:"español",et:"eesti",eu:"euskara",fi:"suomi",fr:"français",fy:"Frysk",gl:"galego",gcf:"Kréyòl gwadloupéyen",he:"עברית",hr:"hrvatski",hu:"magyar",id:"Bahasa Indonesia",is:"íslenska",it:"italiano",ja:"日本語",ko:"한국어",lb:"Lëtzebuergesch",lt:"lietuvių",lv:"latviešu",mk:"македонски",nl:"Nederlands",nn:"norsk nynorsk",no:"norsk bokmål",pl:"polski",pt:"português","pt-br":"português do Brasil",ro:"română","ro-md":"молдовеняскэ",ru:"русский",sk:"slovenčina",sl:"slovenščina",sq:"shqip",sv:"svenska",tr:"Türkçe",uk:"українська",vi:"Tiếng Việt","zh-hans":"中文（简体）","zh-hant":"中文（繁體）","zh-tw":"中文（台灣）"};