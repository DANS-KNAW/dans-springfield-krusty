/**
 * almond 0.2.4 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*! jQuery UI - v1.12.1 - 2016-09-16
 * http://jqueryui.com
 * Includes: position.js
 * Copyright jQuery Foundation and other contributors; Licensed MIT */

/*! jquery.cookie v1.4.1 | MIT */

function toggleFullScreen(){!document.fullscreenElement&&!document.mozFullScreenElement&&!document.webkitFullscreenElement&&!document.msFullscreenElement?(document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),$("#fullscreen > span").addClass("fa-compress"),$("#fullscreen > span").removeClass("fa-expand")):(document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),$("#fullscreen > span").addClass("fa-expand"),$("#fullscreen > span").removeClass("fa-compress"))}function formatTime(e){var t,n,r;return t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=Math.floor(e%60),formattedTime="",t>0&&(t<10&&(formattedTime+="0"),formattedTime+=t+":"),n<10&&(formattedTime+="0"),formattedTime+=n+":",r<10&&(formattedTime+="0"),formattedTime+=r,formattedTime}function toggleFullScreen(){!document.fullscreenElement&&!document.mozFullScreenElement&&!document.webkitFullscreenElement&&!document.msFullscreenElement?(document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),$("#fullscreen > span").addClass("fa-compress"),$("#fullscreen > span").removeClass("fa-expand")):(document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),$("#fullscreen > span").addClass("fa-expand"),$("#fullscreen > span").removeClass("fa-compress"))}function formatTime(e){var t,n,r;return t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=Math.floor(e%60),formattedTime="",t>0&&(t<10&&(formattedTime+="0"),formattedTime+=t+":"),n<10&&(formattedTime+="0"),formattedTime+=n+":",r<10&&(formattedTime+="0"),formattedTime+=r,formattedTime}$.holdReady(!0);var requirejs,require,define;(function(e){function c(e,t){return f.call(e,t)}function h(e,t){var n,r,i,s,o,a,f,l,c,h,p=t&&t.split("/"),d=u.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(l=0;l<e.length;l+=1){h=e[l];if(h===".")e.splice(l,1),l-=1;else if(h===".."){if(l===1&&(e[2]===".."||e[0]===".."))break;l>0&&(e.splice(l-1,2),l-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(l=n.length;l>0;l-=1){r=n.slice(0,l).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=l;break}}}if(s)break;!a&&v&&v[r]&&(a=v[r],f=l)}!s&&a&&(s=a,o=f),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function p(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function d(e){return function(t){return h(t,e)}}function v(e){return function(t){s[e]=t}}function m(n){if(c(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!c(s,n)&&!c(a,n))throw new Error("No "+n);return s[n]}function g(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function y(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice;r=function(e,t){var n,r=g(e),i=r[0];return e=r[1],i&&(i=h(i,t),n=m(i)),i?n&&n.normalize?e=n.normalize(e,d(t)):e=h(e,t):(e=h(e,t),r=g(e),i=r[0],e=r[1],i&&(n=m(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return p(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:y(e)}}},t=function(t,n,u,f){var l,h,d,g,y,b=[],w;f=f||t;if(typeof u=="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){g=r(n[y],f),h=g.f;if(h==="require")b[y]=i.require(t);else if(h==="exports")b[y]=i.exports(t),w=!0;else if(h==="module")l=b[y]=i.module(t);else if(c(s,h)||c(o,h)||c(a,h))b[y]=m(h);else{if(!g.p)throw new Error(t+" missing "+h);g.p.load(g.n,p(f,!0),v(h),{}),b[y]=s[h]}}d=u.apply(s[t],b);if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(d!==e||!w)s[t]=d}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){return typeof s=="string"?i[s]?i[s](o):m(r(s,o).f):(s.splice||(u=s,o.splice?(s=o,o=a,a=null):s=e),o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n)},n.config=function(e){return u=e,n},define=function(e,t,n){t.splice||(n=t,t=[]),!c(s,e)&&!c(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("../libs/almond",function(){}),define("libs/util/Rand",[],function(){var e={};return e.getRandomInt=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},e}),define("config/BaseConfig",[],function(){var e={};return e.baseURI="http://dans.noterik.com",e}),define("libs/springfield/BartConnector",["libs/util/Rand","config/BaseConfig"],function(e,t){function n(e){var n=this,r={bartURI:t.baseURI+"/bart/"};return this.request=function(e){e.url=r.bartURI+e.url,$.ajax(e)},$.extend(r,e),n}return n}),define("libs/springfield/QuickStartConnector",["libs/springfield/BartConnector"],function(e){function t(t){var n={success:null,uri:null},r=e(),i={url:null,type:"POST",accepts:"text/xml",contentType:"text/xml",data:"<fsxml mimetype='application/fscommand' id='dynamic'><properties><handler>/dynamic/presentation/playout/html5</handler></properties></fsxml>"},s=function(){if(n.uri===null)throw"No URI given!";return!0},o=function(){typeof n.success=="function"&&(i.success=n.success),r.request(i)};$.extend(n,t),i.url=n.uri,s(),o()}return t}),define("app/QSResponseParser",["config/BaseConfig"],function(e){var t=function(t){function s(){o(),u()}function o(){var n=$(r.data),s=$(n).find("presentation > videoplaylist > properties > play-mode").text()?$(n).find("presentation > videoplaylist > properties > play-mode").text():"continuous",o=n.find("presentation > videoplaylist").first().find("video"),u=n.find("presentation > videoplaylist").first().find("audio"),a={};a.duration=0,a.length=o.length;var f={};f.duration=0,f.length=u.length,o.length>0&&$.each(o,function(s,o){var u=$(n.find('fsxml > video[fullid|="'+$(o).attr("referid")+'"]')),f={};f.starttime=$(o).find("starttime").text()?parseFloat($(o).find("starttime").text()):0,f.duration=$(o).find("duration").text()?parseFloat($(o).find("duration").text()):-1;var l=$(o).find("webvtt").text()?e.baseURI+"/data"+u.attr("fullid")+"/"+$(o).find("webvtt").text():undefined;f.title=$(o).find("title").text()?$(o).find("title").text():undefined,r.ticket!=undefined&&l!=undefined&&(l=l+"?ticket="+t.ticket);var c=[];if(l==undefined){var h=$(o).find("*").filter(function(){return/^webvtt_/i.test(this.nodeName)});for(i=0;i<h.length;i++){sObj={},sObj.language=h[i].tagName.substr(h[i].tagName.indexOf("_")+1);var p=e.baseURI+"/data"+u.attr("fullid")+"/"+h[i].textContent;r.ticket!=undefined&&(p=p+"?ticket="+t.ticket),sObj.subtitle=p,c.push(sObj)}}else sObj={},sObj.language=undefined,sObj.subtitle=l,c.push(sObj);f.subtitles=c,f.position=s,f.sources=[];var d=0;u.children("rawvideo").length>0&&$.each(u.children("rawvideo"),function(t,n){n=$(n);if(!n.find("original").text()&&n.find("wantedheight").text()!==""||u.children("rawvideo").length===1){var r=!1,i=$.grep(f.sources,function(e){return e.quality==n.find("wantedheight").text()});i===null&&(r=!0,i={}),i.quality=n.find("height").text()+"p",i.codecs===undefined&&(i.codecs=[]);var s={};switch(n.find("extension").text()){case"mp4":s.type="video/mp4"}var a=n.find("mount").text().split(",")[0];s.src=e.baseURI+"/rafael/"+u.attr("fullid")+"/rawvideo/"+n.attr("id")+"/"+n.find("filename").text();var l=u.attr("fullid");i.codecs.push(s),f.sources.push(i),d=n.find("duration").text()!==""?parseFloat(n.find("duration").text())*1e3:d,f.oduration=d,f.referid=$(o).attr("referid")}}),a[s]=f,a.duration=f.duration==-1?a.duration+d:a.duration+f.duration}),u.length>0&&$.each(u,function(t,r){var i=$(n.find('fsxml > audio[fullid|="'+$(r).attr("referid")+'"]')),s={};s.starttime=$(r).find("starttime").text()?parseFloat($(r).find("starttime").text()):0,s.duration=$(r).find("duration").text()?parseFloat($(r).find("duration").text()):-1,s.title=$(r).find("title").text()?$(r).find("title").text():undefined,s.position=t,s.sources=[];var o=0;i.children("rawaudio").length>0&&$.each(i.children("rawaudio"),function(t,n){n=$(n);if(!n.find("original").text()||i.children("rawaudio").length===1){add=!0;var r={};r.codecs===undefined&&(r.codecs=[]);var u={};switch(n.find("extension").text()){case"m4a":u.type="audio/mp4"}var a=n.find("mount").text().split(",")[0];u.src=e.baseURI+"/rafael/"+i.attr("fullid")+"/rawaudio/"+n.attr("id")+"/"+n.find("filename").text();var f=i.attr("fullid");r.codecs.push(u),s.sources.push(r),o=n.find("duration").text()!==""?parseFloat(n.find("duration").text())*1e3:o,s.oduration=o}}),f[t]=s,f.duration=s.duration==-1?f.duration+o:f.duration+s.duration}),r.playMode=s,r.videos=a,r.audios=f}function u(){var t=r.starttime*1e3,n=0,i="";for(var s=0;s<r.videos.length;s++)t-=r.videos[s].duration==-1?r.videos[s].oduration:r.videos[s].duration,t<0&&(i=r.videos[s].referid,t+=r.videos[s].duration==-1?r.videos[s].oduration:r.videos[s].duration,n=r.videos[s].starttime!=0?r.videos[r.currentItem].starttime+t:t);var o=$(r.data),u=$(o.find('fsxml > video[fullid|="'+i+'"]')),a=u.find("screens"),f=a.find("properties > uri").text();f=f.replace("http://",""),f=f.replace(".noterik.com",e.baseURI+"/data");var l=Math.floor(parseInt(n)/1e3)+(n==0?10:0),c=Math.floor(l/3600),h=Math.floor(l%3600/60),p=Math.floor(l%3600%60);r.screenshot=f+"/h/"+c+"/m/"+h+"/sec"+p+".jpg"}var n={},r={data:null,ticket:null,starttime:0,videos:null,audios:null,screenshot:null};return $.extend(r,t),n.getVideos=function(){return r.videos},n.getAudios=function(){return r.audios},n.getPlayMode=function(){return r.playMode},n.getScreenshot=function(){return r.screenshot},s(),n};return t}),function(e){(jQuery.browser=jQuery.browser||{}).mobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}(navigator.userAgent||navigator.vendor||window.opera),define("libs/jquery.browser.mobile",function(){}),function(e){function t(e){for(var t,n=e.split(/\s+/),r=[],i=0;t=n[i];i++)t=t.charAt(0).toUpperCase(),r.push(t);return r}function n(t){return t.id&&e('label[for="'+t.id+'"]').val()||t.name}function r(t,i,s){return s||(s=0),i.each(function(){var i,o,u=e(this),a=this,f=this.nodeName.toLowerCase();switch("label"===f&&u.find("input, textarea, select").length&&(i=u.text(),u=u.children().first(),a=u.get(0),f=a.nodeName.toLowerCase()),f){case"menu":o={name:u.attr("label"),items:{}},s=r(o.items,u.children(),s);break;case"a":case"button":o={name:u.text(),disabled:!!u.attr("disabled"),callback:function(){return function(){u.get(0).click()}}()};break;case"menuitem":case"command":switch(u.attr("type")){case void 0:case"command":case"menuitem":o={name:u.attr("label"),disabled:!!u.attr("disabled"),icon:u.attr("icon"),callback:function(){return function(){u.get(0).click()}}()};break;case"checkbox":o={type:"checkbox",disabled:!!u.attr("disabled"),name:u.attr("label"),selected:!!u.attr("checked")};break;case"radio":o={type:"radio",disabled:!!u.attr("disabled"),name:u.attr("label"),radio:u.attr("radiogroup"),value:u.attr("id"),selected:!!u.attr("checked")};break;default:o=void 0}break;case"hr":o="-------";break;case"input":switch(u.attr("type")){case"text":o={type:"text",name:i||n(a),disabled:!!u.attr("disabled"),value:u.val()};break;case"checkbox":o={type:"checkbox",name:i||n(a),disabled:!!u.attr("disabled"),selected:!!u.attr("checked")};break;case"radio":o={type:"radio",name:i||n(a),disabled:!!u.attr("disabled"),radio:!!u.attr("name"),value:u.val(),selected:!!u.attr("checked")};break;default:o=void 0}break;case"select":o={type:"select",name:i||n(a),disabled:!!u.attr("disabled"),selected:u.val(),options:{}},u.children().each(function(){o.options[this.value]=e(this).text()});break;case"textarea":o={type:"textarea",name:i||n(a),disabled:!!u.attr("disabled"),value:u.val()};break;case"label":break;default:o={type:"html",html:u.clone(!0)}}o&&(s++,t["key"+s]=o)}),s}e.support.htmlMenuitem="HTMLMenuItemElement"in window,e.support.htmlCommand="HTMLCommandElement"in window,e.support.eventSelectstart="onselectstart"in document.documentElement,e.ui&&e.widget||(e.cleanData=function(e){return function(t){var n,r,i;for(i=0;null!=t[i];i++){r=t[i];try{n=s._data(r,"events"),n&&n.remove&&s(r).triggerHandler("remove")}catch(s){}}e(t)}}(e.cleanData));var i=null,s=!1,o=e(window),u=0,a={},f={},l={},c={selector:null,appendTo:null,trigger:"right",autoHide:!1,delay:200,reposition:!0,selectableSubMenu:!1,classNames:{hover:"context-menu-hover",disabled:"context-menu-disabled",visible:"context-menu-visible",notSelectable:"context-menu-not-selectable",icon:"context-menu-icon",iconEdit:"context-menu-icon-edit",iconCut:"context-menu-icon-cut",iconCopy:"context-menu-icon-copy",iconPaste:"context-menu-icon-paste",iconDelete:"context-menu-icon-delete",iconAdd:"context-menu-icon-add",iconQuit:"context-menu-icon-quit",iconLoadingClass:"context-menu-icon-loading"},determinePosition:function(t){if(e.ui&&e.ui.position)t.css("display","block").position({my:"center top",at:"center bottom",of:this,offset:"0 5",collision:"fit"}).css("display","none");else{var n=this.offset();n.top+=this.outerHeight(),n.left+=this.outerWidth()/2-t.outerWidth()/2,t.css(n)}},position:function(e,t,n){var r;if(!t&&!n)return void e.determinePosition.call(this,e.$menu);if("maintain"===t&&"maintain"===n)r=e.$menu.position();else{var i=e.$menu.offsetParent().offset();r={top:n-i.top,left:t-i.left}}var s=o.scrollTop()+o.height(),u=o.scrollLeft()+o.width(),a=e.$menu.outerHeight(),f=e.$menu.outerWidth();r.top+a>s&&(r.top-=a),r.top<0&&(r.top=0),r.left+f>u&&(r.left-=f),r.left<0&&(r.left=0),e.$menu.css(r)},positionSubmenu:function(t){if(void 0!==t)if(e.ui&&e.ui.position)t.css("display","block").position({my:"left top-5",at:"right top",of:this,collision:"flipfit fit"}).css("display","");else{var n={top:-9,left:this.outerWidth()-5};t.css(n)}},zIndex:1,animation:{duration:50,show:"slideDown",hide:"slideUp"},events:{show:e.noop,hide:e.noop},callback:null,items:{}},h={timer:null,pageX:null,pageY:null},p=function(e){for(var t=0,n=e;;)if(t=Math.max(t,parseInt(n.css("z-index"),10)||0),!(n=n.parent())||!n.length||"html body".indexOf(n.prop("nodeName").toLowerCase())>-1)break;return t},d={abortevent:function(e){e.preventDefault(),e.stopImmediatePropagation()},contextmenu:function(t){var n=e(this);if("right"===t.data.trigger&&(t.preventDefault(),t.stopImmediatePropagation()),!("right"!==t.data.trigger&&"demand"!==t.data.trigger&&t.originalEvent||!(void 0===t.mouseButton||!t.data||"left"===t.data.trigger&&0===t.mouseButton||"right"===t.data.trigger&&2===t.mouseButton)||n.hasClass("context-menu-active")||n.hasClass("context-menu-disabled"))){if(i=n,t.data.build){var r=t.data.build(i,t);if(!1===r)return;if(t.data=e.extend(!0,{},c,t.data,r||{}),!t.data.items||e.isEmptyObject(t.data.items))throw window.console&&(console.error||console.log).call(console,"No items specified to show in contextMenu"),new Error("No Items specified");t.data.$trigger=i,v.create(t.data)}var s=!1;for(var o in t.data.items)if(t.data.items.hasOwnProperty(o)){var u;u=e.isFunction(t.data.items[o].visible)?t.data.items[o].visible.call(e(t.currentTarget),o,t.data):void 0===t.data.items[o]||!t.data.items[o].visible||!0===t.data.items[o].visible,u&&(s=!0)}s&&v.show.call(n,t.data,t.pageX,t.pageY)}},click:function(t){t.preventDefault(),t.stopImmediatePropagation(),e(this).trigger(e.Event("contextmenu",{data:t.data,pageX:t.pageX,pageY:t.pageY}))},mousedown:function(t){var n=e(this);i&&i.length&&!i.is(n)&&i.data("contextMenu").$menu.trigger("contextmenu:hide"),2===t.button&&(i=n.data("contextMenuActive",!0))},mouseup:function(t){var n=e(this);n.data("contextMenuActive")&&i&&i.length&&i.is(n)&&!n.hasClass("context-menu-disabled")&&(t.preventDefault(),t.stopImmediatePropagation(),i=n,n.trigger(e.Event("contextmenu",{data:t.data,pageX:t.pageX,pageY:t.pageY}))),n.removeData("contextMenuActive")},mouseenter:function(t){var n=e(this),r=e(t.relatedTarget),s=e(document);r.is(".context-menu-list")||r.closest(".context-menu-list").length||i&&i.length||(h.pageX=t.pageX,h.pageY=t.pageY,h.data=t.data,s.on("mousemove.contextMenuShow",d.mousemove),h.timer=setTimeout(function(){h.timer=null,s.off("mousemove.contextMenuShow"),i=n,n.trigger(e.Event("contextmenu",{data:h.data,pageX:h.pageX,pageY:h.pageY}))},t.data.delay))},mousemove:function(e){h.pageX=e.pageX,h.pageY=e.pageY},mouseleave:function(t){var n=e(t.relatedTarget);if(!n.is(".context-menu-list")&&!n.closest(".context-menu-list").length){try{clearTimeout(h.timer)}catch(t){}h.timer=null}},layerClick:function(t){var n,r,i=e(this),s=i.data("contextMenuRoot"),u=t.button,a=t.pageX,f=t.pageY;t.preventDefault(),setTimeout(function(){var i,l="left"===s.trigger&&0===u||"right"===s.trigger&&2===u;if(document.elementFromPoint&&s.$layer){if(s.$layer.hide(),n=document.elementFromPoint(a-o.scrollLeft(),f-o.scrollTop()),n.isContentEditable){var c=document.createRange(),h=window.getSelection();c.selectNode(n),c.collapse(!0),h.removeAllRanges(),h.addRange(c)}e(n).trigger(t),s.$layer.show()}if(s.reposition&&l)if(document.elementFromPoint){if(s.$trigger.is(n))return void s.position.call(s.$trigger,s,a,f)}else if(r=s.$trigger.offset(),i=e(window),r.top+=i.scrollTop(),r.top<=t.pageY&&(r.left+=i.scrollLeft(),r.left<=t.pageX&&(r.bottom=r.top+s.$trigger.outerHeight(),r.bottom>=t.pageY&&(r.right=r.left+s.$trigger.outerWidth(),r.right>=t.pageX))))return void s.position.call(s.$trigger,s,a,f);n&&l&&s.$trigger.one("contextmenu:hidden",function(){e(n).contextMenu({x:a,y:f,button:u})}),null!==s&&void 0!==s&&null!==s.$menu&&void 0!==s.$menu&&s.$menu.trigger("contextmenu:hide")},50)},keyStop:function(e,t){t.isInput||e.preventDefault(),e.stopPropagation()},key:function(e){var t={};i&&(t=i.data("contextMenu")||{}),void 0===t.zIndex&&(t.zIndex=0);var n=0,r=function(e){""!==e.style.zIndex?n=e.style.zIndex:null!==e.offsetParent&&void 0!==e.offsetParent?r(e.offsetParent):null!==e.parentElement&&void 0!==e.parentElement&&r(e.parentElement)};if(r(e.target),!(t.$menu&&parseInt(n,10)>parseInt(t.$menu.css("zIndex"),10))){switch(e.keyCode){case 9:case 38:if(d.keyStop(e,t),t.isInput){if(9===e.keyCode&&e.shiftKey)return e.preventDefault(),t.$selected&&t.$selected.find("input, textarea, select").blur(),void (null!==t.$menu&&void 0!==t.$menu&&t.$menu.trigger("prevcommand"));if(38===e.keyCode&&"checkbox"===t.$selected.find("input, textarea, select").prop("type"))return void e.preventDefault()}else if(9!==e.keyCode||e.shiftKey)return void (null!==t.$menu&&void 0!==t.$menu&&t.$menu.trigger("prevcommand"));break;case 40:if(d.keyStop(e,t),!t.isInput)return void (null!==t.$menu&&void 0!==t.$menu&&t.$menu.trigger("nextcommand"));if(9===e.keyCode)return e.preventDefault(),t.$selected&&t.$selected.find("input, textarea, select").blur(),void (null!==t.$menu&&void 0!==t.$menu&&t.$menu.trigger("nextcommand"));if(40===e.keyCode&&"checkbox"===t.$selected.find("input, textarea, select").prop("type"))return void e.preventDefault();break;case 37:if(d.keyStop(e,t),t.isInput||!t.$selected||!t.$selected.length)break;if(!t.$selected.parent().hasClass("context-menu-root")){var s=t.$selected.parent().parent();return t.$selected.trigger("contextmenu:blur"),void (t.$selected=s)}break;case 39:if(d.keyStop(e,t),t.isInput||!t.$selected||!t.$selected.length)break;var o=t.$selected.data("contextMenu")||{};if(o.$menu&&t.$selected.hasClass("context-menu-submenu"))return t.$selected=null,o.$selected=null,void o.$menu.trigger("nextcommand");break;case 35:case 36:return t.$selected&&t.$selected.find("input, textarea, select").length?void 0:((t.$selected&&t.$selected.parent()||t.$menu).children(":not(."+t.classNames.disabled+", ."+t.classNames.notSelectable+")")[36===e.keyCode?"first":"last"]().trigger("contextmenu:focus"),void e.preventDefault());case 13:if(d.keyStop(e,t),t.isInput){if(t.$selected&&!t.$selected.is("textarea, select"))return void e.preventDefault();break}return void (void 0!==t.$selected&&null!==t.$selected&&t.$selected.trigger("mouseup"));case 32:case 33:case 34:return void d.keyStop(e,t);case 27:return d.keyStop(e,t),void (null!==t.$menu&&void 0!==t.$menu&&t.$menu.trigger("contextmenu:hide"));default:var u=String.fromCharCode(e.keyCode).toUpperCase();if(t.accesskeys&&t.accesskeys[u])return void t.accesskeys[u].$node.trigger(t.accesskeys[u].$menu?"contextmenu:focus":"mouseup")}e.stopPropagation(),void 0!==t.$selected&&null!==t.$selected&&t.$selected.trigger(e)}},prevItem:function(t){t.stopPropagation();var n=e(this).data("contextMenu")||{},r=e(this).data("contextMenuRoot")||{};if(n.$selected){var i=n.$selected;n=n.$selected.parent().data("contextMenu")||{},n.$selected=i}for(var s=n.$menu.children(),o=n.$selected&&n.$selected.prev().length?n.$selected.prev():s.last(),u=o;o.hasClass(r.classNames.disabled)||o.hasClass(r.classNames.notSelectable)||o.is(":hidden");)if(o=o.prev().length?o.prev():s.last(),o.is(u))return;n.$selected&&d.itemMouseleave.call(n.$selected.get(0),t),d.itemMouseenter.call(o.get(0),t);var a=o.find("input, textarea, select");a.length&&a.focus()},nextItem:function(t){t.stopPropagation();var n=e(this).data("contextMenu")||{},r=e(this).data("contextMenuRoot")||{};if(n.$selected){var i=n.$selected;n=n.$selected.parent().data("contextMenu")||{},n.$selected=i}for(var s=n.$menu.children(),o=n.$selected&&n.$selected.next().length?n.$selected.next():s.first(),u=o;o.hasClass(r.classNames.disabled)||o.hasClass(r.classNames.notSelectable)||o.is(":hidden");)if(o=o.next().length?o.next():s.first(),o.is(u))return;n.$selected&&d.itemMouseleave.call(n.$selected.get(0),t),d.itemMouseenter.call(o.get(0),t);var a=o.find("input, textarea, select");a.length&&a.focus()},focusInput:function(){var t=e(this).closest(".context-menu-item"),n=t.data(),r=n.contextMenu,i=n.contextMenuRoot;i.$selected=r.$selected=t,i.isInput=r.isInput=!0},blurInput:function(){var t=e(this).closest(".context-menu-item"),n=t.data(),r=n.contextMenu;n.contextMenuRoot.isInput=r.isInput=!1},menuMouseenter:function(){e(this).data().contextMenuRoot.hovering=!0},menuMouseleave:function(t){var n=e(this).data().contextMenuRoot;n.$layer&&n.$layer.is(t.relatedTarget)&&(n.hovering=!1)},itemMouseenter:function(t){var n=e(this),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot;if(s.hovering=!0,t&&s.$layer&&s.$layer.is(t.relatedTarget)&&(t.preventDefault(),t.stopImmediatePropagation()),(i.$menu?i:s).$menu.children("."+s.classNames.hover).trigger("contextmenu:blur").children(".hover").trigger("contextmenu:blur"),n.hasClass(s.classNames.disabled)||n.hasClass(s.classNames.notSelectable))return void (i.$selected=null);n.trigger("contextmenu:focus")},itemMouseleave:function(t){var n=e(this),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot;if(s!==i&&s.$layer&&s.$layer.is(t.relatedTarget))return void 0!==s.$selected&&null!==s.$selected&&s.$selected.trigger("contextmenu:blur"),t.preventDefault(),t.stopImmediatePropagation(),void (s.$selected=i.$selected=i.$node);i&&i.$menu&&i.$menu.hasClass("context-menu-visible")||n.trigger("contextmenu:blur")},itemClick:function(t){var n,r=e(this),i=r.data(),s=i.contextMenu,o=i.contextMenuRoot,u=i.contextMenuKey;if(!(!s.items[u]||r.is("."+o.classNames.disabled+", .context-menu-separator, ."+o.classNames.notSelectable)||r.is(".context-menu-submenu")&&!1===o.selectableSubMenu)){if(t.preventDefault(),t.stopImmediatePropagation(),e.isFunction(s.callbacks[u])&&Object.prototype.hasOwnProperty.call(s.callbacks,u))n=s.callbacks[u];else{if(!e.isFunction(o.callback))return;n=o.callback}!1!==n.call(o.$trigger,u,o,t)?o.$menu.trigger("contextmenu:hide"):o.$menu.parent().length&&v.update.call(o.$trigger,o)}},inputClick:function(e){e.stopImmediatePropagation()},hideMenu:function(t,n){var r=e(this).data("contextMenuRoot");v.hide.call(r.$trigger,r,n&&n.force)},focusItem:function(t){t.stopPropagation();var n=e(this),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot;n.hasClass(s.classNames.disabled)||n.hasClass(s.classNames.notSelectable)||(n.addClass([s.classNames.hover,s.classNames.visible].join(" ")).parent().find(".context-menu-item").not(n).removeClass(s.classNames.visible).filter("."+s.classNames.hover).trigger("contextmenu:blur"),i.$selected=s.$selected=n,i&&i.$node&&i.$node.hasClass("context-menu-submenu")&&i.$node.addClass(s.classNames.hover),i.$node&&s.positionSubmenu.call(i.$node,i.$menu))},blurItem:function(t){t.stopPropagation();var n=e(this),r=n.data(),i=r.contextMenu,s=r.contextMenuRoot;i.autoHide&&n.removeClass(s.classNames.visible),n.removeClass(s.classNames.hover),i.$selected=null}},v={show:function(t,n,r){var s=e(this),o={};if(e("#context-menu-layer").trigger("mousedown"),t.$trigger=s,!1===t.events.show.call(s,t))return void (i=null);if(v.update.call(s,t),t.position.call(s,t,n,r),t.zIndex){var u=t.zIndex;"function"==typeof t.zIndex&&(u=t.zIndex.call(s,t)),o.zIndex=p(s)+u}v.layer.call(t.$menu,t,o.zIndex),t.$menu.find("ul").css("zIndex",o.zIndex+1),t.$menu.css(o)[t.animation.show](t.animation.duration,function(){s.trigger("contextmenu:visible")}),s.data("contextMenu",t).addClass("context-menu-active"),e(document).off("keydown.contextMenu").on("keydown.contextMenu",d.key),t.autoHide&&e(document).on("mousemove.contextMenuAutoHide",function(e){var n=s.offset();n.right=n.left+s.outerWidth(),n.bottom=n.top+s.outerHeight(),!t.$layer||t.hovering||e.pageX>=n.left&&e.pageX<=n.right&&e.pageY>=n.top&&e.pageY<=n.bottom||setTimeout(function(){t.hovering||null===t.$menu||void 0===t.$menu||t.$menu.trigger("contextmenu:hide")},50)})},hide:function(e,t){var n=r(this);if(e||(e=n.data("contextMenu")||{}),t||!e.events||!1!==e.events.hide.call(n,e)){if(n.removeData("contextMenu").removeClass("context-menu-active"),e.$layer){setTimeout(function(e){return function(){e.remove()}}(e.$layer),10);try{delete e.$layer}catch(r){e.$layer=null}}i=null,e.$menu.find("."+e.classNames.hover).trigger("contextmenu:blur"),e.$selected=null,e.$menu.find("."+e.classNames.visible).removeClass(e.classNames.visible),r(document).off(".contextMenuAutoHide").off("keydown.contextMenu"),e.$menu&&e.$menu[e.animation.hide](e.animation.duration,function(){e.build&&(e.$menu.remove(),r.each(e,function(t){switch(t){case"ns":case"selector":case"build":case"trigger":return!0;default:e[t]=void 0;try{delete e[t]}catch(t){}return!0}})),setTimeout(function(){n.trigger("contextmenu:hidden")},10)})}},create:function(n,r){function i(t){var n=e("<span></span>");if(t._accesskey)t._beforeAccesskey&&n.append(document.createTextNode(t._beforeAccesskey)),e("<span></span>").addClass("context-menu-accesskey").text(t._accesskey).appendTo(n),t._afterAccesskey&&n.append(document.createTextNode(t._afterAccesskey));else if(t.isHtmlName){if(void 0!==t.accesskey)throw new Error("accesskeys are not compatible with HTML names and cannot be used together in the same item");n.html(t.name)}else n.text(t.name);return n}void 0===r&&(r=n),n.$menu=e('<ul class="context-menu-list"></ul>').addClass(n.className||"").data({contextMenu:n,contextMenuRoot:r}),e.each(["callbacks","commands","inputs"],function(e,t){n[t]={},r[t]||(r[t]={})}),r.accesskeys||(r.accesskeys={}),e.each(n.items,function(s,o){var u=e('<li class="context-menu-item"></li>').addClass(o.className||""),a=null,f=null;if(u.on("click",e.noop),"string"!=typeof o&&"cm_separator"!==o.type||(o={type:"cm_seperator"}),o.$node=u.data({contextMenu:n,contextMenuRoot:r,contextMenuKey:s}),void 0!==o.accesskey)for(var c,h=t(o.accesskey),p=0;c=h[p];p++)if(!r.accesskeys[c]){r.accesskeys[c]=o;var m=o.name.match(new RegExp("^(.*?)("+c+")(.*)$","i"));m&&(o._beforeAccesskey=m[1],o._accesskey=m[2],o._afterAccesskey=m[3]);break}if(o.type&&l[o.type])l[o.type].call(u,o,n,r),e.each([n,r],function(t,r){r.commands[s]=o,!e.isFunction(o.callback)||void 0!==r.callbacks[s]&&void 0!==n.type||(r.callbacks[s]=o.callback)});else{switch("cm_seperator"===o.type?u.addClass("context-menu-separator "+r.classNames.notSelectable):"html"===o.type?u.addClass("context-menu-html "+r.classNames.notSelectable):"sub"===o.type||(o.type?(a=e("<label></label>").appendTo(u),i(o).appendTo(a),u.addClass("context-menu-input"),n.hasTypes=!0,e.each([n,r],function(e,t){t.commands[s]=o,t.inputs[s]=o})):o.items&&(o.type="sub")),o.type){case"cm_seperator":break;case"text":f=e('<input type="text" value="1" name="" />').attr("name","context-menu-input-"+s).val(o.value||"").appendTo(a);break;case"textarea":f=e('<textarea name=""></textarea>').attr("name","context-menu-input-"+s).val(o.value||"").appendTo(a),o.height&&f.height(o.height);break;case"checkbox":f=e('<input type="checkbox" value="1" name="" />').attr("name","context-menu-input-"+s).val(o.value||"").prop("checked",!!o.selected).prependTo(a);break;case"radio":f=e('<input type="radio" value="1" name="" />').attr("name","context-menu-input-"+o.radio).val(o.value||"").prop("checked",!!o.selected).prependTo(a);break;case"select":f=e('<select name=""></select>').attr("name","context-menu-input-"+s).appendTo(a),o.options&&(e.each(o.options,function(t,n){e("<option></option>").val(t).text(n).appendTo(f)}),f.val(o.selected));break;case"sub":i(o).appendTo(u),o.appendTo=o.$node,u.data("contextMenu",o).addClass("context-menu-submenu"),o.callback=null,"function"==typeof o.items.then?v.processPromises(o,r,o.items):v.create(o,r);break;case"html":e(o.html).appendTo(u);break;default:e.each([n,r],function(t,r){r.commands[s]=o,!e.isFunction(o.callback)||void 0!==r.callbacks[s]&&void 0!==n.type||(r.callbacks[s]=o.callback)}),i(o).appendTo(u)}o.type&&"sub"!==o.type&&"html"!==o.type&&"cm_seperator"!==o.type&&(f.on("focus",d.focusInput).on("blur",d.blurInput),o.events&&f.on(o.events,n)),o.icon&&(e.isFunction(o.icon)?o._icon=o.icon.call(this,this,u,s,o):"string"==typeof o.icon&&"fa-"===o.icon.substring(0,3)?o._icon=r.classNames.icon+" "+r.classNames.icon+"--fa fa "+o.icon:o._icon=r.classNames.icon+" "+r.classNames.icon+"-"+o.icon,u.addClass(o._icon))}o.$input=f,o.$label=a,u.appendTo(n.$menu),!n.hasTypes&&e.support.eventSelectstart&&u.on("selectstart.disableTextSelect",d.abortevent)}),n.$node||n.$menu.css("display","none").addClass("context-menu-root"),n.$menu.appendTo(n.appendTo||document.body)},resize:function(t,n){var r;t.css({position:"absolute",display:"block"}),t.data("width",(r=t.get(0)).getBoundingClientRect?Math.ceil(r.getBoundingClientRect().width):t.outerWidth()+1),t.css({position:"static",minWidth:"0px",maxWidth:"100000px"}),t.find("> li > ul").each(function(){v.resize(e(this),!0)}),n||t.find("ul").addBack().css({position:"",display:"",minWidth:"",maxWidth:""}).outerWidth(function(){return e(this).data("width")})},update:function(t,n){var r=this;void 0===n&&(n=t,v.resize(t.$menu)),t.$menu.children().each(function(){var i,s=e(this),o=s.data("contextMenuKey"),u=t.items[o],a=e.isFunction(u.disabled)&&u.disabled.call(r,o,n)||!0===u.disabled;if(i=e.isFunction(u.visible)?u.visible.call(r,o,n):void 0===u.visible||!0===u.visible,s[i?"show":"hide"](),s[a?"addClass":"removeClass"](n.classNames.disabled),e.isFunction(u.icon)&&(s.removeClass(u._icon),u._icon=u.icon.call(this,r,s,o,u),s.addClass(u._icon)),u.type)switch(s.find("input, select, textarea").prop("disabled",a),u.type){case"text":case"textarea":u.$input.val(u.value||"");break;case"checkbox":case"radio":u.$input.val(u.value||"").prop("checked",!!u.selected);break;case"select":u.$input.val((0===u.selected?"0":u.selected)||"")}u.$menu&&v.update.call(r,u,n)})},layer:function(t,n){var r=t.$layer=e('<div id="context-menu-layer"></div>').css({height:o.height(),width:o.width(),display:"block",position:"fixed","z-index":n,top:0,left:0,opacity:0,filter:"alpha(opacity=0)","background-color":"#000"}).data("contextMenuRoot",t).insertBefore(this).on("contextmenu",d.abortevent).on("mousedown",d.layerClick);return void 0===document.body.style.maxWidth&&r.css({position:"absolute",height:e(document).height()}),r},processPromises:function(e,t,n){function r(e,t,n){void 0===n&&i(void 0),s(e,t,n)}function i(e,t,n){void 0===n?(n={error:{name:"No items and no error item",icon:"context-menu-icon context-menu-icon-quit"}},window.console&&(console.error||console.log).call(console,'When you reject a promise, provide an "items" object, equal to normal sub-menu items')):"string"==typeof n&&(n={error:{name:n}}),s(e,t,n)}function s(e,t,n){void 0!==t.$menu&&t.$menu.is(":visible")&&(e.$node.removeClass(t.classNames.iconLoadingClass),e.items=n,v.create(e,t,!0),v.update(e,t),t.positionSubmenu.call(e.$node,e.$menu))}e.$node.addClass(t.classNames.iconLoadingClass),n.then(r.bind(this,e,t),i.bind(this,e,t))}};e.fn.contextMenu=function(t){var n=this,r=t;if(this.length>0)if(void 0===t)this.first().trigger("contextmenu");else if(void 0!==t.x&&void 0!==t.y)this.first().trigger(e.Event("contextmenu",{pageX:t.x,pageY:t.y,mouseButton:t.button}));else if("hide"===t){var i=this.first().data("contextMenu")?this.first().data("contextMenu").$menu:null;i&&i.trigger("contextmenu:hide")}else"destroy"===t?e.contextMenu("destroy",{context:this}):e.isPlainObject(t)?(t.context=this,e.contextMenu("create",t)):t?this.removeClass("context-menu-disabled"):t||this.addClass("context-menu-disabled");else e.each(f,function(){this.selector===n.selector&&(r.data=this,e.extend(r.data,{trigger:"demand"}))}),d.contextmenu.call(r.target,r);return this},e.contextMenu=function(e,t){"string"!=typeof e&&(t=e,e="create"),"string"==typeof t?t={selector:t}:void 0===t&&(t={});var n=g.extend(!0,{},c,t||{}),r=g(document),i=r,o=!1;switch(n.context&&n.context.length?(i=g(n.context).first(),n.context=i.get(0),o=!g(n.context).is(document)):n.context=document,e){case"create":if(!n.selector)throw new Error("No selector specified");if(n.selector.match(/.context-menu-(list|item|input)($|\s)/))throw new Error('Cannot bind to selector "'+n.selector+'" as it contains a reserved className');if(!n.build&&(!n.items||g.isEmptyObject(n.items)))throw new Error("No Items specified");if(u++,n.ns=".contextMenu"+u,o||(a[n.selector]=n.ns),f[n.ns]=n,n.trigger||(n.trigger="right"),!s){var l="click"===n.itemClickEvent?"click.contextMenu":"mouseup.contextMenu",h={"contextmenu:focus.contextMenu":d.focusItem,"contextmenu:blur.contextMenu":d.blurItem,"contextmenu.contextMenu":d.abortevent,"mouseenter.contextMenu":d.itemMouseenter,"mouseleave.contextMenu":d.itemMouseleave};h[l]=d.itemClick,r.on({"contextmenu:hide.contextMenu":d.hideMenu,"prevcommand.contextMenu":d.prevItem,"nextcommand.contextMenu":d.nextItem,"contextmenu.contextMenu":d.abortevent,"mouseenter.contextMenu":d.menuMouseenter,"mouseleave.contextMenu":d.menuMouseleave},".context-menu-list").on("mouseup.contextMenu",".context-menu-input",d.inputClick).on(h,".context-menu-item"),s=!0}switch(i.on("contextmenu"+n.ns,n.selector,n,d.contextmenu),o&&i.on("remove"+n.ns,function(){g(this).contextMenu("destroy")}),n.trigger){case"hover":i.on("mouseenter"+n.ns,n.selector,n,d.mouseenter).on("mouseleave"+n.ns,n.selector,n,d.mouseleave);break;case"left":i.on("click"+n.ns,n.selector,n,d.click)}n.build||v.create(n);break;case"destroy":var p;if(o){var m=n.context;g.each(f,function(e,t){if(!t)return!0;if(!n(m).is(t.selector))return!0;p=n(".context-menu-list").filter(":visible"),p.length&&p.data().contextMenuRoot.$trigger.is(n(t.context).find(t.selector))&&p.trigger("contextmenu:hide",{force:!0});try{f[t.ns].$menu&&f[t.ns].$menu.remove(),delete f[t.ns]}catch(n){f[t.ns]=null}return n(t.context).off(t.ns),!0})}else if(n.selector){if(a[n.selector]){p=g(".context-menu-list").filter(":visible"),p.length&&p.data().contextMenuRoot.$trigger.is(n.selector)&&p.trigger("contextmenu:hide",{force:!0});try{f[a[n.selector]].$menu&&f[a[n.selector]].$menu.remove(),delete f[a[n.selector]]}catch(g){f[a[n.selector]]=null}r.off(a[n.selector])}}else r.off(".contextMenu .contextMenuAutoHide"),g.each(f,function(e,t){g(t.context).off(t.ns)}),a={},f={},u=0,s=!1,g("#context-menu-layer, .context-menu-list").remove();break;case"html5":(!g.support.htmlCommand&&!g.support.htmlMenuitem||"boolean"==typeof t&&t)&&g('menu[type="context"]').each(function(){this.id&&g.contextMenu({selector:"[contextmenu="+this.id+"]",items:g.contextMenu.fromMenu(this)})}).css("display","none");break;default:throw new Error('Unknown operation "'+e+'"')}return this},e.contextMenu.setInputValues=function(t,n){void 0===n&&(n={}),e.each(t.inputs,function(e,t){switch(t.type){case"text":case"textarea":t.value=n[e]||"";break;case"checkbox":t.selected=!!n[e];break;case"radio":t.selected=(n[t.radio]||"")===t.value;break;case"select":t.selected=n[e]||""}})},e.contextMenu.getInputValues=function(t,n){return void 0===n&&(n={}),e.each(t.inputs,function(e,t){switch(t.type){case"text":case"textarea":case"select":n[e]=t.$input.val();break;case"checkbox":n[e]=t.$input.prop("checked");break;case"radio":t.$input.prop("checked")&&(n[t.radio]=t.value)}}),n},e.contextMenu.fromMenu=function(t){var n=e(t),i={};return r(i,n.children()),i},e.contextMenu.defaults=c,e.contextMenu.types=l,e.contextMenu.handle=d,e.contextMenu.op=v,e.contextMenu.menus=f}(jQuery),define("libs/contextmenu/jquery.contextMenu.min",function(){}),function(e){e.ui=e.ui||{},e.ui.version="1.12.1",function(){function n(e,t,n){return[parseFloat(e[0])*(h.test(e[0])?t/100:1),parseFloat(e[1])*(h.test(e[1])?n/100:1)]}function r(n,r){return parseInt(e.css(n,r),10)||0}function i(n){var r=n[0];return 9===r.nodeType?{width:n.width(),height:n.height(),offset:{top:0,left:0}}:e.isWindow(r)?{width:n.width(),height:n.height(),offset:{top:n.scrollTop(),left:n.scrollLeft()}}:r.preventDefault?{width:0,height:0,offset:{top:r.pageY,left:r.pageX}}:{width:n.outerWidth(),height:n.outerHeight(),offset:n.offset()}}var s,o=Math.max,u=Math.abs,a=/left|center|right/,f=/top|center|bottom/,l=/[\+\-]\d+(\.[\d]+)?%?/,c=/^\w+/,h=/%$/,p=e.fn.position;e.position={scrollbarWidth:function(){if(void 0!==s)return s;var n,r,i=e("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=i.children()[0];return e("body").append(i),n=o.offsetWidth,i.css("overflow","scroll"),r=o.offsetWidth,n===r&&(r=i[0].clientWidth),i.remove(),s=n-r},getScrollInfo:function(n){var r=n.isWindow||n.isDocument?"":n.element.css("overflow-x"),i=n.isWindow||n.isDocument?"":n.element.css("overflow-y"),s="scroll"===r||"auto"===r&&n.width<n.element[0].scrollWidth,o="scroll"===i||"auto"===i&&n.height<n.element[0].scrollHeight;return{width:o?e.position.scrollbarWidth():0,height:s?e.position.scrollbarWidth():0}},getWithinInfo:function(n){var r=e(n||window),i=e.isWindow(r[0]),s=!!r[0]&&9===r[0].nodeType,o=!i&&!s;return{element:r,isWindow:i,isDocument:s,offset:o?e(n).offset():{left:0,top:0},scrollLeft:r.scrollLeft(),scrollTop:r.scrollTop(),width:r.outerWidth(),height:r.outerHeight()}}},e.fn.position=function(s){if(!s||!s.of)return p.apply(this,arguments);s=e.extend({},s);var h,v,m,g,y,b,w=e(s.of),E=e.position.getWithinInfo(s.within),S=e.position.getScrollInfo(E),x=(s.collision||"flip").split(" "),T={};return b=i(w),w[0].preventDefault&&(s.at="left top"),v=b.width,m=b.height,g=b.offset,y=e.extend({},g),e.each(["my","at"],function(){var e,t,n=(s[this]||"").split(" ");1===n.length&&(n=a.test(n[0])?n.concat(["center"]):f.test(n[0])?["center"].concat(n):["center","center"]),n[0]=a.test(n[0])?n[0]:"center",n[1]=f.test(n[1])?n[1]:"center",e=l.exec(n[0]),t=l.exec(n[1]),T[this]=[e?e[0]:0,t?t[0]:0],s[this]=[c.exec(n[0])[0],c.exec(n[1])[0]]}),1===x.length&&(x[1]=x[0]),"right"===s.at[0]?y.left+=v:"center"===s.at[0]&&(y.left+=v/2),"bottom"===s.at[1]?y.top+=m:"center"===s.at[1]&&(y.top+=m/2),h=n(T.at,v,m),y.left+=h[0],y.top+=h[1],this.each(function(){var i,a,f=e(this),l=f.outerWidth(),c=f.outerHeight(),p=r(this,"marginLeft"),d=r(this,"marginTop"),b=l+p+r(this,"marginRight")+S.width,N=c+d+r(this,"marginBottom")+S.height,C=e.extend({},y),L=n(T.my,f.outerWidth(),f.outerHeight());"right"===s.my[0]?C.left-=l:"center"===s.my[0]&&(C.left-=l/2),"bottom"===s.my[1]?C.top-=c:"center"===s.my[1]&&(C.top-=c/2),C.left+=L[0],C.top+=L[1],i={marginLeft:p,marginTop:d},e.each(["left","top"],function(n,r){e.ui.position[x[n]]&&e.ui.position[x[n]][r](C,{targetWidth:v,targetHeight:m,elemWidth:l,elemHeight:c,collisionPosition:i,collisionWidth:b,collisionHeight:N,offset:[h[0]+L[0],h[1]+L[1]],my:s.my,at:s.at,within:E,elem:f})}),s.using&&(a=function(e){var t=g.left-C.left,n=t+v-l,r=g.top-C.top,i=r+m-c,a={target:{element:w,left:g.left,top:g.top,width:v,height:m},element:{element:f,left:C.left,top:C.top,width:l,height:c},horizontal:0>n?"left":t>0?"right":"center",vertical:0>i?"top":r>0?"bottom":"middle"};l>v&&v>u(t+n)&&(a.horizontal="center"),c>m&&m>u(r+i)&&(a.vertical="middle"),a.important=o(u(t),u(n))>o(u(r),u(i))?"horizontal":"vertical",s.using.call(this,e,a)}),f.offset(e.extend(C,{using:a}))})},e.ui.position={fit:{left:function(e,t){var n,r=t.within,i=r.isWindow?r.scrollLeft:r.offset.left,s=r.width,u=e.left-t.collisionPosition.marginLeft,a=i-u,f=u+t.collisionWidth-s-i;t.collisionWidth>s?a>0&&0>=f?(n=e.left+a+t.collisionWidth-s-i,e.left+=a-n):e.left=f>0&&0>=a?i:a>f?i+s-t.collisionWidth:i:a>0?e.left+=a:f>0?e.left-=f:e.left=o(e.left-u,e.left)},top:function(e,t){var n,r=t.within,i=r.isWindow?r.scrollTop:r.offset.top,s=t.within.height,u=e.top-t.collisionPosition.marginTop,a=i-u,f=u+t.collisionHeight-s-i;t.collisionHeight>s?a>0&&0>=f?(n=e.top+a+t.collisionHeight-s-i,e.top+=a-n):e.top=f>0&&0>=a?i:a>f?i+s-t.collisionHeight:i:a>0?e.top+=a:f>0?e.top-=f:e.top=o(e.top-u,e.top)}},flip:{left:function(e,t){var n,r,i=t.within,s=i.offset.left+i.scrollLeft,o=i.width,a=i.isWindow?i.scrollLeft:i.offset.left,f=e.left-t.collisionPosition.marginLeft,l=f-a,c=f+t.collisionWidth-o-a,h="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,p="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,d=-2*t.offset[0];0>l?(n=e.left+h+p+d+t.collisionWidth-o-s,(0>n||u(l)>n)&&(e.left+=h+p+d)):c>0&&(r=e.left-t.collisionPosition.marginLeft+h+p+d-a,(r>0||c>u(r))&&(e.left+=h+p+d))},top:function(e,t){var n,r,i=t.within,s=i.offset.top+i.scrollTop,o=i.height,a=i.isWindow?i.scrollTop:i.offset.top,f=e.top-t.collisionPosition.marginTop,l=f-a,c=f+t.collisionHeight-o-a,h="top"===t.my[1],p=h?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,d="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,v=-2*t.offset[1];0>l?(r=e.top+p+d+v+t.collisionHeight-o-s,(0>r||u(l)>r)&&(e.top+=p+d+v)):c>0&&(n=e.top-t.collisionPosition.marginTop+p+d+v-a,(n>0||c>u(n))&&(e.top+=p+d+v))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}}}(),e.ui.position}(jQuery),define("libs/contextmenu/jquery.ui.position.min",function(){}),function(e){function t(e){return u.raw?e:encodeURIComponent(e)}function n(e){return u.raw?e:decodeURIComponent(e)}function r(e){return t(u.json?JSON.stringify(e):String(e))}function i(e){0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(o," ")),u.json?JSON.parse(e):e}catch(t){}}function s(t,n){var r=u.raw?t:i(t);return e.isFunction(n)?n(r):r}var o=/\+/g,u=e.cookie=function(i,o,l){if(void 0!==o&&!e.isFunction(o)){if(l=e.extend({},u.defaults,l),"number"==typeof l.expires){var p=l.expires,v=l.expires=new Date;v.setTime(+v+864e5*p)}return document.cookie=[t(i),"=",r(o),l.expires?"; expires="+l.expires.toUTCString():"",l.path?"; path="+l.path:"",l.domain?"; domain="+l.domain:"",l.secure?"; secure":""].join("")}for(var m=i?void 0:{},g=document.cookie?document.cookie.split("; "):[],y=0,w=g.length;w>y;y++){var E=g[y].split("="),S=n(E.shift()),x=E.join("=");if(i&&i===S){m=s(x,o);break}i||void 0===(x=s(x))||(m[S]=x)}return m};u.defaults={},e.removeCookie=function(t,n){return void 0===e.cookie(t)?!1:(e.cookie(t,"",e.extend({},n,{expires:-1})),!e.cookie(t))}}(jQuery),define("libs/jquery.cookie-1.4.1.min",function(){}),define("app/VideoElementCreator",["libs/jquery.browser.mobile","libs/contextmenu/jquery.contextMenu.min","libs/contextmenu/jquery.ui.position.min","libs/jquery.cookie-1.4.1.min"],function(){var e=function(e){var t={},n={videos:null,quality:"360p",currentOrder:null,currentItem:0,order:{mobile:["360p","180p","720p","1080p"],desktop:["720p","1080p","720p","1080p"]},ticket:null,starttime:0,wasPlaying:!1,seekTime:-1,playMode:null},r=0,i=0,s=!1,o="";$.extend(n,e),t.create=function(){var e=$(document.createElement("video"));e.attr("id","videoplayer"),n.starttime>0&&v();var t=u(n),h=a(t.codecs,"video/mp4");if(h.streamSrc!==undefined){var m=$(document.createElement("source"));m.attr("src",h.streamSrc),m.attr("type",h.type),e.append(m)}t=$(document.createElement("source")),t.attr("src",h.src+f()),t.attr("type",h.type),e.append(t),n.playMode=="menu"&&p();var g=l();if(g!=undefined&&g.length>0){$("#subtitles").show();var y={};for(var b=0;b<g.length;b++){var w={},E=$(document.createElement("track"));E.attr("src",g[b].subtitle),E.attr("kind","subtitles"),g[b].language!=undefined&&(w.name=languageArray[g[b].language],E.attr("srclang",g[b].language),E.attr("label",languageArray[g[b].language]),$.cookie("subtitles")=="true"&&$.cookie("language")==g[b].language&&(E.attr("default","default"),$("#subtitles > span").addClass("subtitles-enabled"),$("#subtitles > span").removeClass("subtitles-crossed-out"),w.icon="fa-check",s=!0,o=g[b].language)),e.append(E),y[g[b].language]=w}var w={};w.name="Disabled",$.cookie("subtitles")!="true"&&(w.icon="fa-check"),y.disabled=w,g.length>1&&jQuery.contextMenu({selector:"#subtitles",trigger:"left",build:function(t,n){return{callback:function(t,n){$(e.prop("textTracks")).prop("mode",function(){return y[this.language].icon="",this.language==t&&(y[this.language].icon="fa-check",y.disabled.icon=""),this.language==t?"showing":"disabled"}),t=="disabled"?(y.disabled.icon="fa-check",$.cookie("subtitles","false"),s=!1,$("#subtitles > span").removeClass("subtitles-enabled"),$("#subtitles > span").addClass("subtitles-crossed-out")):(s=!0,o=t,$.cookie("subtitles","true"),$.cookie("language",t),$("#subtitles > span").addClass("subtitles-enabled"),$("#subtitles > span").removeClass("subtitles-crossed-out"))},items:y}}})}else $("#subtitles").hide();return e.on("ended",function(){n.playMode=="menu"?$("#menu").show():(n.currentItem=n.currentItem<n.videos.length-1?n.currentItem+1:0,c(e))}),$("#seek-bar").attr("max",n.videos.duration),$("#playtime").text(formatTime(0)),$("#totaltime").text(formatTime(n.videos.duration/1e3)),e.on("play",function(){$("#play-pause > span").addClass("fa-pause"),$("#play-pause > span").removeClass("fa-play")}),e.on("pause",function(){$("#play-pause > span").addClass("fa-play"),$("#play-pause > span").removeClass("fa-pause")}),e.on("timeupdate",function(){if(n.playMode=="menu"){var t=this.currentTime*1e3-n.videos[n.currentItem].starttime;t<0&&(t=0),$("#playtime").text(formatTime(t/1e3)),$("#seek-bar").val(t)}else{var t=this.currentTime*1e3-n.videos[n.currentItem].starttime;t<0&&(t=0),$("#playtime").text(formatTime(i/1e3+t/1e3)),$("#seek-bar").val(i+t),n.videos[n.currentItem].duration!=-1&&t>=n.videos[n.currentItem].duration&&(n.currentItem=n.currentItem<n.videos.length-1?n.currentItem+1:0,c(e))}}),e[0].addEventListener("volumechange",function(){e[0].muted==1||e[0].volume==0?($("#mute-unmute > span").addClass("fa-volume-off"),$("#mute-unmute > span").removeClass("fa-volume-up"),$("#mute-unmute > span").removeClass("fa-volume-down")):e[0].volume<.5?($("#mute-unmute > span").addClass("fa-volume-down"),$("#mute-unmute > span").removeClass("fa-volume-off"),$("#mute-unmute > span").removeClass("fa-volume-up")):($("#mute-unmute > span").addClass("fa-volume-up"),$("#mute-unmute > span").removeClass("fa-volume-off"),$("#mute-unmute > span").removeClass("fa-volume-down"))}),e[0].addEventListener("loadedmetadata",function(){n.seekTime!=-1?(e[0].currentTime=n.seekTime/1e3,n.seekTime=-1):n.videos[n.currentItem].starttime!=0&&(e[0].currentTime=n.videos[n.currentItem].starttime/1e3),n.wasPlaying&&e[0].paused&&e[0].play(),n.wasPlaying=!1}),$("#play-pause").click(function(){e[0].paused==1?e[0].play():e[0].pause()}),$("#mute-unmute").click(function(){e[0].muted==1?(e[0].muted=!1,$("#volume-bar").val(r)):(e[0].muted=!0,r=$("#volume-bar").val(),$("#volume-bar").val(0))}),$("#volume-bar").on("change mousemove",function(){e[0].volume=$(this).val(),$(this).val()>0&&e[0].muted==1&&(e[0].muted=!1)}),$("#seek-bar").on("change",function(){var t=$(this).val();if(n.playMode=="menu")n.videos[n.currentItem].starttime!=0?e[0].currentTime=n.videos[n.currentItem].starttime/1e3+t/1e3:e[0].currentTime=t/1e3,n.wasPlaying&&e[0].paused&&e[0].play(),n.wasPlaying=!1;else{var r=0;for(var r=0;r<n.videos.length;r++){t-=n.videos[r].duration==-1?n.videos[r].oduration:n.videos[r].duration;if(t<0){t+=n.videos[r].duration==-1?n.videos[r].oduration:n.videos[r].duration,n.currentItem==r?(n.videos[n.currentItem].starttime!=0?e[0].currentTime=n.videos[n.currentItem].starttime/1e3+t/1e3:e[0].currentTime=t/1e3,n.wasPlaying&&e[0].paused&&e[0].play(),n.wasPlaying=!1):(n.currentItem=r,n.seekTime=n.videos[r].starttime!=0?n.videos[n.currentItem].starttime+t:t,c(e));break}}}}),$("#seek-bar").on("input",function(){!e[0].paused&&!e[0].ended&&(n.wasPlaying=!0,e[0].pause()),$("#playtime").text(formatTime($(this).val()/1e3))}),$("#fullscreen").click(function(){toggleFullScreen()}),$("#subtitles").click(function(e){var t=l();t.length==1&&d()}),$(window).on("resize",function(){e.width($("#videoplayer").parent().width()),e.height($("#videoplayer").parent().height()),$(".playIcon").css("left",$("#videoplayer").width()/2-$(".playIcon").width()/2+"px"),$(".playIcon").css("top",$("#videoplayer").height()/2-$(".playIcon").height()/2+"px");var t=325,r=l();r!=undefined&&r.length>0&&(t+=20),n.playMode=="menu"&&(t+=20),$("#seek-bar").css("width",$("#videoplayer").parent().width()-t+"px")}),$("body").on("click",".menuitem",function(t){var r=t.target.id.substr(t.target.id.indexOf("_")+1);n.currentItem=r;var i=n.videos[r].duration==-1?n.videos[r].oduration:n.videos[r].duration;$("#seek-bar").attr("max",i-n.videos[r].starttime),$("#playtime").text(formatTime(0)),$("#totaltime").text(formatTime((i-n.videos[r].starttime)/1e3)),$("#menu").hide(),c(e),e[0].currentTime=0,e[0].play()}),$("body").on("click","#menuicon",function(){e[0].pause(),$("#menu").show()}),e};var u=function(){return currentSource=n.videos[n.currentItem].sources[n.videos[n.currentItem].sources.length-1],currentSource},a=function(e,t){return $.grep(e,function(e){if(e.type==t)return e})[0]},f=function(){return query="",n.ticket!=null&&(query="?ticket="+n.ticket),query},l=function(){return n.videos[n.currentItem].subtitles},c=function(e){var t=u(),r=a(t.codecs,"video/mp4");if(n.currentItem==0)e.removeAttr("autoplay"),i=0;else{e.attr("autoplay","autoplay");for(var c=0;c<n.currentItem;c++)i+=n.videos[c].duration==-1?n.videos[c].oduration:n.videos[c].duration}e.children("source").first().attr("src",r.src+f());var h=l();if(h!=undefined&&h.length>0){jQuery.contextMenu("destroy"),$(e.children("track").remove()),$("#subtitles").show();var p={};for(var c=0;c<h.length;c++){var d={},v=$(document.createElement("track"));v.attr("src",h[c].subtitle),v.attr("kind","subtitles"),h[c].language!=undefined&&(d.name=languageArray[h[c].language],v.attr("srclang",h[c].language),v.attr("label",languageArray[h[c].language]),s&&o==h[c].language&&(d.icon="fa-check",v.attr("default","default"))),e.append(v),p[h[c].language]=d}var d={};d.name="Disabled",s||(d.icon="fa-check"),p.disabled=d,h.length>1?(navigator.userAgent.search("Firefox")>-1&&$(e.prop("textTracks")).prop("mode",function(){return this.language==o?"showing":"disabled"}),jQuery.contextMenu({selector:"#subtitles",trigger:"left",build:function(t,n){return{callback:function(t,n){$(e.prop("textTracks")).prop("mode",function(){return p[this.language].icon="",this.language==t&&(p[this.language].icon="fa-check",p.disabled.icon=""),this.language==t?"showing":"disabled"}),t=="disabled"?(p.disabled.icon="fa-check",$.cookie("subtitles","false"),s=!1,$("#subtitles > span").removeClass("subtitles-enabled"),$("#subtitles > span").addClass("subtitles-crossed-out")):(s=!0,o=t,$.cookie("subtitles","true"),$.cookie("language",t),$("#subtitles > span").addClass("subtitles-enabled"),$("#subtitles > span").removeClass("subtitles-crossed-out"))},items:p}}})):h.length==1&&s&&navigator.userAgent.search("Firefox")>-1&&$(e.prop("textTracks")).first().prop("mode","showing")}else jQuery.contextMenu("destroy"),$("#subtitles").hide();e.load()},h=function(){n.currentOrder=n.order.desktop,$.browser.mobile&&(n.currentOrder=n.order.mobile)},p=function(){var e=$(document.createElement("div"));e.attr("id","menu");for(var t=0;t<n.videos.length;t++){var r=$(document.createElement("div"));r.attr("id","videoitem_"+t),r.attr("class","menuitem"),r.text(n.videos[t].title),e.append(r)}$("body").append(e)},d=function(){var e=document.getElementById("videoplayer");e.textTracks[0].mode=="showing"?(s=!1,$.cookie("subtitles","false"),e.textTracks[0].mode="hidden",$("#subtitles > span").removeClass("subtitles-enabled"),$("#subtitles > span").addClass("subtitles-crossed-out")):(s=!0,$.cookie("subtitles","true"),e.textTracks[0].mode="showing",$("#subtitles > span").removeClass("subtitles-crossed-out"),$("#subtitles > span").addClass("subtitles-enabled"))},v=function(){var e=n.starttime*1e3;i=0;for(var t=0;t<n.videos.length;t++)e-=n.videos[t].duration==-1?n.videos[t].oduration:n.videos[t].duration,e<0?(n.currentItem=t,e+=n.videos[t].duration==-1?n.videos[t].oduration:n.videos[t].duration,n.seekTime=n.videos[t].starttime!=0?n.videos[n.currentItem].starttime+e:e):i+=n.videos[t].duration==-1?n.videos[t].oduration:n.videos[t].duration};return h(),t};return e});var languageArray={am:"አማርኛ",ar:"العربية",ast:"asturianu",az:"azərbaycanca",bg:"български",br:"brezhoneg",bs:"bosanski",ca:"català",co:"corsu",cs:"čeština",da:"dansk",de:"Deutsch",el:"Ελληνικά",en:"English",eo:"Esperanto",es:"español",et:"eesti",eu:"euskara",fi:"suomi",fr:"français",fy:"Frysk",gl:"galego",gcf:"Kréyòl gwadloupéyen",he:"עברית",hr:"hrvatski",hu:"magyar",id:"Bahasa Indonesia",is:"íslenska",it:"italiano",ja:"日本語",ko:"한국어",lb:"Lëtzebuergesch",lt:"lietuvių",lv:"latviešu",mk:"македонски",nl:"Nederlands",nn:"norsk nynorsk",no:"norsk bokmål",pl:"polski",pt:"português","pt-br":"português do Brasil",ro:"română","ro-md":"молдовеняскэ",ru:"русский",sk:"slovenčina",sl:"slovenščina",sq:"shqip",sv:"svenska",tr:"Türkçe",uk:"українська",vi:"Tiếng Việt","zh-hans":"中文（简体）‎","zh-hant":"中文（繁體）‎","zh-tw":"中文（台灣）‎"};define("app/AudioElementCreator",["libs/jquery.browser.mobile","libs/contextmenu/jquery.contextMenu.min","libs/contextmenu/jquery.ui.position.min"],function(){var e=function(e){var t={},n={audios:null,currentItem:0,ticket:null,starttime:0,wasPlaying:!1,seekTime:-1,playMode:null},r=0,i=0,s=!1,o="";$.extend(n,e),t.create=function(){var e=$(document.createElement("audio"));e.attr("id","videoplayer"),n.starttime>0&&d();var t=u(n),v=a(t.codecs,"audio/mp4");if(v.streamSrc!==undefined){var m=$(document.createElement("source"));m.attr("src",v.streamSrc),m.attr("type",v.type),e.append(m)}t=$(document.createElement("source")),t.attr("src",v.src+f()),t.attr("type",v.type),e.append(t),n.playMode=="menu"&&h();var g=l();if(g!=undefined&&g.length>0){$("#subtitles").show();var y={};for(var b=0;b<g.length;b++){var w={},E=$(document.createElement("track"));E.attr("src",g[b].subtitle),E.attr("kind","subtitles"),g[b].language!=undefined&&(w.name=languageArray[g[b].language],E.attr("srclang",g[b].language),E.attr("label",languageArray[g[b].language]),$.cookie("subtitles")=="true"&&$.cookie("language")==g[b].language&&(E.attr("default","default"),$("#subtitles > span").addClass("subtitles-enabled"),$("#subtitles > span").removeClass("subtitles-crossed-out"),w.icon="fa-check",s=!0,o=g[b].language)),e.append(E),y[g[b].language]=w}var w={};w.name="Disabled",$.cookie("subtitles")!="true"&&(w.icon="fa-check"),y.disabled=w,g.length>1&&jQuery.contextMenu({selector:"#subtitles",trigger:"left",build:function(t,n){return{callback:function(t,n){$(e.prop("textTracks")).prop("mode",function(){return y[this.language].icon="",this.language==t&&(y[this.language].icon="fa-check",y.disabled.icon=""),this.language==t?"showing":"disabled"}),t=="disabled"?(y.disabled.icon="fa-check",$.cookie("subtitles","false"),s=!1,$("#subtitles > span").removeClass("subtitles-enabled"),$("#subtitles > span").addClass("subtitles-crossed-out")):(s=!0,o=t,$.cookie("subtitles","true"),$.cookie("language",t),$("#subtitles > span").addClass("subtitles-enabled"),$("#subtitles > span").removeClass("subtitles-crossed-out"))},items:y}}})}else $("#subtitles").hide();return $("#fullscreen").hide(),e.on("ended",function(){n.playMode=="menu"?$("#menu").show():(n.currentItem=n.currentItem<n.audios.length-1?n.currentItem+1:0,c(e))}),$("#seek-bar").attr("max",n.audios.duration),$("#playtime").text(formatTime(0)),$("#totaltime").text(formatTime(n.audios.duration/1e3)),e.on("play",function(){$("#play-pause > span").addClass("fa-pause"),$("#play-pause > span").removeClass("fa-play")}),e.on("pause",function(){$("#play-pause > span").addClass("fa-play"),$("#play-pause > span").removeClass("fa-pause")}),e.on("timeupdate",function(){if(n.playMode=="menu"){var t=this.currentTime*1e3-n.audios[n.currentItem].starttime;t<0&&(t=0),$("#playtime").text(formatTime(t/1e3)),$("#seek-bar").val(t)}else{var t=this.currentTime*1e3-n.audios[n.currentItem].starttime;t<0&&(t=0),$("#playtime").text(formatTime(i/1e3+t/1e3)),$("#seek-bar").val(i+t),n.audios[n.currentItem].duration!=-1&&t>=n.audios[n.currentItem].duration&&(n.currentItem=n.currentItem<n.audios.length-1?n.currentItem+1:0,c(e))}}),e[0].addEventListener("volumechange",function(){e[0].muted==1||e[0].volume==0?($("#mute-unmute > span").addClass("fa-volume-off"),$("#mute-unmute > span").removeClass("fa-volume-up"),$("#mute-unmute > span").removeClass("fa-volume-down")):e[0].volume<.5?($("#mute-unmute > span").addClass("fa-volume-down"),$("#mute-unmute > span").removeClass("fa-volume-off"),$("#mute-unmute > span").removeClass("fa-volume-up")):($("#mute-unmute > span").addClass("fa-volume-up"),$("#mute-unmute > span").removeClass("fa-volume-off"),$("#mute-unmute > span").removeClass("fa-volume-down"))}),e[0].addEventListener("loadedmetadata",function(){n.seekTime!=-1?(e[0].currentTime=n.seekTime/1e3,n.seekTime=-1):n.audios[n.currentItem].starttime!=0&&(e[0].currentTime=n.audios[n.currentItem].starttime/1e3),n.wasPlaying&&e[0].paused&&e[0].play(),n.wasPlaying=!1}),$("#play-pause").click(function(){e[0].paused==1?e[0].play():e[0].pause()}),$("#mute-unmute").click(function(){e[0].muted==1?(e[0].muted=!1,$("#volume-bar").val(r)):(e[0].muted=!0,r=$("#volume-bar").val(),$("#volume-bar").val(0))}),$("#volume-bar").on("change mousemove",function(){e[0].volume=$(this).val(),$(this).val()>0&&e[0].muted==1&&(e[0].muted=!1)}),$("#seek-bar").on("change",function(){var t=$(this).val();if(n.playMode=="menu")n.audios[n.currentItem].starttime!=0?e[0].currentTime=n.audios[n.currentItem].starttime/1e3+t/1e3:e[0].currentTime=t/1e3,n.wasPlaying&&e[0].paused&&e[0].play(),n.wasPlaying=!1;else{var r=0;for(var r=0;r<n.audios.length;r++){t-=n.audios[r].duration==-1?n.audios[r].oduration:n.audios[r].duration;if(t<0){t+=n.audios[r].duration==-1?n.audios[r].oduration:n.audios[r].duration,n.currentItem==r?(n.audios[n.currentItem].starttime!=0?e[0].currentTime=n.audios[n.currentItem].starttime/1e3+t/1e3:e[0].currentTime=t/1e3,n.wasPlaying&&e[0].paused&&e[0].play(),n.wasPlaying=!1):(n.currentItem=r,n.seekTime=n.audios[r].starttime!=0?n.audios[n.currentItem].starttime+t:t,c(e));break}}}}),$("#seek-bar").on("input",function(){!e[0].paused&&!e[0].ended&&(n.wasPlaying=!0,e[0].pause()),$("#playtime").text(formatTime($(this).val()/1e3))}),$("#fullscreen").click(function(){toggleFullScreen()}),$("#subtitles").click(function(e){var t=l();t.length==1&&p()}),$(window).on("resize",function(){e.width($("#videoplayer").parent().width()),e.height($("#videoplayer").parent().height()),$(".playIcon").css("left",$("#videoplayer").width()/2-$(".playIcon").width()/2+"px"),$(".playIcon").css("top",$("#videoplayer").height()/2-$(".playIcon").height()/2+"px");var t=325,r=l();r!=undefined&&r.length>0&&(t+=20),n.playMode=="menu"&&(t+=20),$("#seek-bar").css("width",$("#videoplayer").parent().width()-t+"px")}),$("body").on("click",".menuitem",function(t){var r=t.target.id.substr(t.target.id.indexOf("_")+1);n.currentItem=r;var i=n.audios[r].duration==-1?n.audios[r].oduration:n.audios[r].duration;$("#seek-bar").attr("max",i-n.audios[r].starttime),$("#playtime").text(formatTime(0)),$("#totaltime").text(formatTime((i-n.audios[r].starttime)/1e3)),$("#menu").hide(),c(e),e[0].currentTime=0,e[0].play()}),$("body").on("click","#menuicon",function(){e[0].pause(),$("#menu").show()}),e};var u=function(){return currentSource=n.audios[n.currentItem].sources[n.audios[n.currentItem].sources.length-1],currentSource},a=function(e,t){return $.grep(e,function(e){if(e.type==t)return e})[0]},f=function(){return query="",n.ticket!=null&&(query="?ticket="+n.ticket),query},l=function(){return n.audios[n.currentItem].subtitles},c=function(e){var t=u(),r=a(t.codecs,"audio/mp4");if(n.currentItem==0)e.removeAttr("autoplay"),i=0;else{e.attr("autoplay","autoplay");for(var c=0;c<n.currentItem;c++)i+=n.audios[c].duration==-1?n.audios[c].oduration:n.audios[c].duration}e.children("source").first().attr("src",r.src+f());var h=l();if(h!=undefined&&h.length>0){jQuery.contextMenu("destroy"),e.children("track").remove(),$("#subtitles").show();var p={};for(var c=0;c<h.length;c++){var d={},v=$(document.createElement("track"));v.attr("src",h[c].subtitle),v.attr("kind","subtitles"),h[c].language!=undefined&&(d.name=languageArray[h[c].language],v.attr("srclang",h[c].language),v.attr("label",languageArray[h[c].language]),s&&o==h[c].language&&(d.icon="fa-check",v.attr("default","default"))),e.append(v),p[h[c].language]=d}var d={};d.name="Disabled",s||(d.icon="fa-check"),p.disabled=d,h.length>1?(navigator.userAgent.search("Firefox")>-1&&$(e.prop("textTracks")).prop("mode",function(){return this.language==o?"showing":"disabled"}),jQuery.contextMenu({selector:"#subtitles",trigger:"left",build:function(t,n){return{callback:function(t,n){$(e.prop("textTracks")).prop("mode",function(){return p[this.language].icon="",this.language==t&&(p[this.language].icon="fa-check",p.disabled.icon=""),this.language==t?"showing":"disabled"}),t=="disabled"?(p.disabled.icon="fa-check",$.cookie("subtitles","false"),s=!1,$("#subtitles > span").removeClass("subtitles-enabled"),$("#subtitles > span").addClass("subtitles-crossed-out")):(s=!0,o=t,$.cookie("subtitles","true"),$.cookie("language",t),$("#subtitles > span").addClass("subtitles-enabled"),$("#subtitles > span").removeClass("subtitles-crossed-out"))},items:p}}})):h.length==1&&s&&navigator.userAgent.search("Firefox")>-1&&$(e.prop("textTracks")).first().prop("mode","showing")}else jQuery.contextMenu("destroy"),$("#subtitles").hide();e.load()},h=function(){var e=$(document.createElement("div"));e.attr("id","menu");for(var t=0;t<n.audios.length;t++){var r=$(document.createElement("div"));r.attr("id","audioitem_"+t),r.attr("class","menuitem"),r.text(n.audios[t].title),e.append(r)}$("body").append(e)},p=function(){var e=document.getElementById("videoplayer");e.textTracks[0].mode=="showing"?(s=!1,$.cookie("subtitles","false"),e.textTracks[0].mode="hidden",$("#subtitles > span").removeClass("subtitles-enabled"),$("#subtitles > span").addClass("subtitles-crossed-out")):(s=!0,$.cookie("subtitles","true"),e.textTracks[0].mode="showing",$("#subtitles > span").removeClass("subtitles-crossed-out"),$("#subtitles > span").addClass("subtitles-enabled"))},d=function(){var e=n.starttime*1e3;for(var t=0;t<n.audios.length;t++)e-=n.audios[t].duration==-1?n.audios[t].oduration:n.audios[t].duration,e<0?(n.currentItem=t,e+=n.audios[t].duration==-1?n.audios[t].oduration:n.audios[t].duration,n.seekTime=n.audios[t].starttime!=0?n.audios[n.currentItem].starttime+e:e):i+=n.audios[t].duration==-1?n.audios[t].oduration:n.audios[t].duration};return t};return e});var languageArray={am:"አማርኛ",ar:"العربية",ast:"asturianu",az:"azərbaycanca",bg:"български",br:"brezhoneg",bs:"bosanski",ca:"català",co:"corsu",cs:"čeština",da:"dansk",de:"Deutsch",el:"Ελληνικά",en:"English",eo:"Esperanto",es:"español",et:"eesti",eu:"euskara",fi:"suomi",fr:"français",fy:"Frysk",gl:"galego",gcf:"Kréyòl gwadloupéyen",he:"עברית",hr:"hrvatski",hu:"magyar",id:"Bahasa Indonesia",is:"íslenska",it:"italiano",ja:"日本語",ko:"한국어",lb:"Lëtzebuergesch",lt:"lietuvių",lv:"latviešu",mk:"македонски",nl:"Nederlands",nn:"norsk nynorsk",no:"norsk bokmål",pl:"polski",pt:"português","pt-br":"português do Brasil",ro:"română","ro-md":"молдовеняскэ",ru:"русский",sk:"slovenčina",sl:"slovenščina",sq:"shqip",sv:"svenska",tr:"Türkçe",uk:"українська",vi:"Tiếng Việt","zh-hans":"中文（简体）‎","zh-hant":"中文（繁體）‎","zh-tw":"中文（台灣）‎"};requirejs.config({baseUrl:"js/krusty-minimal"}),define("app/jquery.krusty-minimal",["libs/springfield/QuickStartConnector","app/QSResponseParser","app/VideoElementCreator","app/AudioElementCreator"],function(e,t,n,r){(function(i){function a(e,t){t.on("loadstart",function(){i(e).trigger("loadstart")}),t.on("playing",function(){i(e).trigger("playing")}),t.on("pause",function(){i(e).trigger("pause")})}var s=null,o=null,u=null;jQuery.fn.krusty=function(e){if(f[e])return console.log(f),f[e].apply(this,Array.prototype.slice.call(arguments,1));if(typeof e=="object"||!e)return f.init.apply(this,arguments);i.error("Method "+e+" does not exist on jQuery.krustyMinimal")};var f={init:function(f){var l=this,c=e({uri:f.uri,success:function(e){var c=t({data:e,ticket:f.ticket,starttime:f.start}),h=c.getVideos(),p=c.getAudios(),d=c.getPlayMode(),v=c.getScreenshot();f.ticket!=null&&(v=v+"?ticket="+f.ticket);var m;p.length>0?m=r({audios:p,quality:f.quality,ticket:f.ticket,playMode:d,starttime:f.start}):m=n({videos:h,quality:f.quality,ticket:f.ticket,playMode:d,starttime:f.start}),s=m.create(),a(l,s),s.width(i(l)[0].clientWidth),s.height(i(l)[0].clientHeight),o=i(document.createElement("img")),p.length>0?o.attr("src","img/audio.png"):o.attr("src",v),o.attr("class","bgImage"),o.attr("width",i(l)[0].clientWidth),o.attr("height",i(l)[0].clientHeight),u=i(document.createElement("div")),u.attr("class","playIcon"),u.on("click",function(){s[0].play()}),s.on("play",function(){u.hide(),p.length==0&&o.hide()}),i(l).append(s),d=="continuous"?(i(l).append(o),i(l).append(u)):(i("#menuicon").show(),p.length>0&&i(l).append(o)),u.css("left",s.width()/2-u.width()/2+"px"),u.css("top",s.height()/2-u.height()/2+"px"),i("#seek-bar").css("width",i("#videoplayer").width()-365+"px")}})},resize:function(){s.width(i(self)[0].clientWidth),s.height(i(self)[0].clientHeight),o.attr("width",s[0].clientWidth),o.attr("height",s[0].clientHeight),u.css("left",s.width()/2-u.width()/2+"px"),u.css("top",s.height()/2-u.height()/2+"px")}};jQuery.holdReady(!1)})(jQuery)}),require(["app/jquery.krusty-minimal"])