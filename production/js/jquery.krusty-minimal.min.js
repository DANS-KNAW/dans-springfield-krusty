/**
 * almond 0.2.4 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

$.holdReady(!0);var requirejs,require,define;(function(e){function c(e,t){return f.call(e,t)}function h(e,t){var n,r,i,s,o,a,f,l,c,h,p=t&&t.split("/"),d=u.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(l=0;l<e.length;l+=1){h=e[l];if(h===".")e.splice(l,1),l-=1;else if(h===".."){if(l===1&&(e[2]===".."||e[0]===".."))break;l>0&&(e.splice(l-1,2),l-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(l=n.length;l>0;l-=1){r=n.slice(0,l).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=l;break}}}if(s)break;!a&&v&&v[r]&&(a=v[r],f=l)}!s&&a&&(s=a,o=f),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function p(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function d(e){return function(t){return h(t,e)}}function v(e){return function(t){s[e]=t}}function m(n){if(c(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!c(s,n)&&!c(a,n))throw new Error("No "+n);return s[n]}function g(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function y(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice;r=function(e,t){var n,r=g(e),i=r[0];return e=r[1],i&&(i=h(i,t),n=m(i)),i?n&&n.normalize?e=n.normalize(e,d(t)):e=h(e,t):(e=h(e,t),r=g(e),i=r[0],e=r[1],i&&(n=m(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return p(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:y(e)}}},t=function(t,n,u,f){var l,h,d,g,y,b=[],w;f=f||t;if(typeof u=="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){g=r(n[y],f),h=g.f;if(h==="require")b[y]=i.require(t);else if(h==="exports")b[y]=i.exports(t),w=!0;else if(h==="module")l=b[y]=i.module(t);else if(c(s,h)||c(o,h)||c(a,h))b[y]=m(h);else{if(!g.p)throw new Error(t+" missing "+h);g.p.load(g.n,p(f,!0),v(h),{}),b[y]=s[h]}}d=u.apply(s[t],b);if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(d!==e||!w)s[t]=d}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){return typeof s=="string"?i[s]?i[s](o):m(r(s,o).f):(s.splice||(u=s,o.splice?(s=o,o=a,a=null):s=e),o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n)},n.config=function(e){return u=e,n},define=function(e,t,n){t.splice||(n=t,t=[]),!c(s,e)&&!c(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("../libs/almond",function(){}),define("libs/util/Rand",[],function(){var e={};return e.getRandomInt=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},e}),define("libs/springfield/BartConnector",["libs/util/Rand"],function(e){function t(e){var t=this,n={bartURI:"http://streaming11.dans.knaw.nl/bart/"};return this.request=function(e){e.url=n.bartURI+e.url,$.ajax(e)},$.extend(n,e),t}return t}),define("libs/springfield/QuickStartConnector",["libs/springfield/BartConnector"],function(e){function t(t){var n={success:null,uri:null},r=e(),i={url:null,type:"POST",accepts:"text/xml",contentType:"text/xml",data:"<fsxml mimetype='application/fscommand' id='dynamic'><properties><handler>/dynamic/presentation/playout/html5</handler></properties></fsxml>"},s=function(){if(n.uri===null)throw"No URI given!";return!0},o=function(){typeof n.success=="function"&&(i.success=n.success),r.request(i)};$.extend(n,t),i.url=n.uri,s(),o()}return t}),define("app/QSResponseParser",[],function(){var e=function(e){function r(){i(),s()}function i(){var e=$(n.data),t=e.find("presentation > videoplaylist").first().find("video"),r={};r.duration=0,r.length=t.length,$.each(t,function(t,n){var i=$(e.find('fsxml > video[fullid|="'+$(n).attr("referid")+'"]')),s={};s.starttime=$(n).find("starttime").text()?parseFloat($(n).find("starttime").text()):0,s.duration=$(n).find("duration").text()?parseFloat($(n).find("duration").text()):-1,s.position=t,s.sources=[];var o=0;i.children("rawvideo").length>0&&$.each(i.children("rawvideo"),function(e,t){t=$(t);if(!t.find("original").text()&&t.find("wantedheight").text()!==""||i.children("rawvideo").length===1){var n=!1,r=$.grep(s.sources,function(e){return e.quality==t.find("wantedheight").text()});r===null&&(n=!0,r={}),r.quality=t.find("height").text()+"p",r.codecs===undefined&&(r.codecs=[]);var u={};switch(t.find("extension").text()){case"mp4":u.type="video/mp4"}var a=t.find("mount").text().split(",")[0];u.src="http://streaming11.dans.knaw.nl/rafael/"+i.attr("fullid")+"/rawvideo/"+t.attr("id")+"/"+t.find("filename").text();var f=i.attr("fullid");r.codecs.push(u),s.sources.push(r),o=t.find("duration").text()!==""?parseFloat(t.find("duration").text())*1e3:o}}),r[t]=s,r.duration=s.duration==-1?r.duration+o:r.duration+s.duration}),n.videos=r}function s(){var e=$(n.data),t=e.find("presentation > videoplaylist").first().find("video").first(),r=$(t).find("starttime").text()?$(t).find("starttime").text():0,i=$(e.find('fsxml > video[fullid|="'+t.attr("referid")+'"]')),s=i.find("screens"),o=s.find("properties > uri").text();o=o.replace(".noterik.com","streaming11.dans.knaw.nl/stills");var u=Math.floor(parseInt(r)/1e3)+10,a=Math.floor(u/3600),f=Math.floor(u%3600/60),l=Math.floor(u%3600%60);n.screenshot=o+"/h/"+a+"/m/"+f+"/sec"+l+".jpg"}var t={},n={data:null,videos:null,screenshot:null};return $.extend(n,e),t.getVideos=function(){return n.videos},t.getScreenshot=function(){return n.screenshot},r(),t};return e}),function(e){(jQuery.browser=jQuery.browser||{}).mobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}(navigator.userAgent||navigator.vendor||window.opera),define("libs/jquery.browser.mobile",function(){}),define("app/VideoElementCreator",["libs/jquery.browser.mobile"],function(){var e=function(e){var t={},n={videos:null,quality:"360p",currentOrder:null,currentItem:0,order:{mobile:["360p","180p","720p","1080p"],desktop:["720p","1080p","720p","1080p"]},ticket:null};$.extend(n,e),t.create=function(){var e=$(document.createElement("video"));e.attr("controls","controls"),e.attr("id","videoplayer");var t=r(),o=i(t.codecs,"video/mp4");if(o.streamSrc!==undefined){var u=$(document.createElement("source"));u.attr("src",o.streamSrc),u.attr("type",o.type),e.append(u)}return t=$(document.createElement("source")),t.attr("src",o.src+s()),t.attr("type",o.type),e.append(t),e.on("ended",function(){n.currentItem=n.currentItem<n.videos.length-1?n.currentItem+1:0;var e=r(),t=i(e.codecs,"video/mp4");n.currentItem==0?$(this).removeAttr("autoplay"):$(this).attr("autoplay","autoplay"),$(this).children("source").first().attr("src",t.src+s()),$(this).load()}),e};var r=function(){return currentSource=n.videos[n.currentItem].sources[n.videos[n.currentItem].sources.length-1],currentSource},i=function(e,t){return $.grep(e,function(e){if(e.type==t)return e})[0]},s=function(){query="?ticket="+n.ticket;if(n.videos[n.currentItem].starttime!=0||n.videos[n.currentItem].duration!=-1)query+="&t=",n.videos[n.currentItem].starttime!=0&&(query+=n.videos[n.currentItem].starttime==0?",":n.videos[n.currentItem].starttime/1e3+","),n.videos[n.currentItem].duration!=-1&&(query+=(n.videos[n.currentItem].starttime+n.videos[n.currentItem].duration)/1e3);return query},o=function(){n.currentOrder=n.order.desktop,$.browser.mobile&&(n.currentOrder=n.order.mobile)};return o(),t};return e}),requirejs.config({baseUrl:"js/krusty-minimal"}),define("app/jquery.krusty-minimal",["libs/springfield/QuickStartConnector","app/QSResponseParser","app/VideoElementCreator"],function(e,t,n){(function(r){function u(e,t){t.on("loadstart",function(){r(e).trigger("loadstart")}),t.on("playing",function(){r(e).trigger("playing")}),t.on("pause",function(){r(e).trigger("pause")})}var i=null,s=null,o=null;jQuery.fn.krusty=function(e){if(a[e])return console.log(a),a[e].apply(this,Array.prototype.slice.call(arguments,1));if(typeof e=="object"||!e)return a.init.apply(this,arguments);r.error("Method "+e+" does not exist on jQuery.krustyMinimal")};var a={init:function(a){var f=this,l=e({uri:a.uri,success:function(e){var l=t({data:e}),c=l.getVideos(),h=l.getScreenshot(),p=n({videos:c,quality:a.quality,ticket:a.ticket});i=p.create(),u(f,i),i.width(r(f)[0].clientWidth),i.height(r(f)[0].clientHeight),s=r(document.createElement("img")),s.attr("class","bgImage"),s.attr("src",h),s.attr("width",i[0].clientWidth),s.attr("height",i[0].clientHeight),o=r(document.createElement("div")),o.attr("class","playIcon"),o.on("click",function(){i[0].play()}),i.on("play",function(){o.hide(),s.hide()}),r(f).append(i),r(f).append(s),r(f).append(o),o.css("left",i.width()/2-o.width()/2+"px"),o.css("top",i.height()/2-o.height()/2+"px")}})},resize:function(){i.width(r(self)[0].clientWidth),i.height(r(self)[0].clientHeight),s.attr("width",i[0].clientWidth),s.attr("height",i[0].clientHeight),o.css("left",i.width()/2-o.width()/2+"px"),o.css("top",i.height()/2-o.height()/2+"px")}};jQuery.holdReady(!1)})(jQuery)}),require(["app/jquery.krusty-minimal"])